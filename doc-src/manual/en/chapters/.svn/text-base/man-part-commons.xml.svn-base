<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbookxi.rng" type="xml"?>
<part version="5.0" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
    xmlns:xi="http://www.w3.org/2001/XInclude">
    <title>Common features</title>
    <partintro>
        <para>This part will describe the common features for all graphs as well as explaining the
            structure of a typical graph script. After reading through this part the user should
            have a basic understanding how to create simple graph scripts and understand what core
            settings and naming conventions are used.</para>
    </partintro>
    <chapter>
        <title>Commonalities for all graphs</title>
        <para>All graph scripts follow, to some extent, the same structure. All scripts must start
            by creating an instance of the Graph class. The Graph class represent the entire graph
            and can have one or more plots build up from the data series. Almost all methods that
            are used to control the appearance of the graph are methods of this class.</para>
        <para>In order to give a feel for common objects we show examples of two of the most
            commonly used graph types, cartesian graphs and pie graphs in the following two
            sections.</para>
        <sect1>
            <title>Common objects for cartesian graphs (x-, y-graphs)</title>
            <para>In all documentation of the library the convention is that the instance of the
                Graph class will be stored in a variable named "<code>$graph</code>". Most of the
                parts that make up a graph are available as instance variables of the Graph class.
                In order to illustrate some of the commonly used instance variables <xref
                    xlink:href="#fig.common-objects"/> shows a basic graph with a number of the
                objects that can be manipulated in the graph scripts.</para>
            <para>
                <figure xml:id="fig.common-objects">
                    <title>Commonly used objects in a graph (<uri
                            xlink:href="example_src/common-obj-graph.html"
                            >common-obj-graph.php</uri>)</title>
                    <mediaobject>
                        <imageobject><imagedata scale="70" fileref="images/graph-obj-overview.png"
                            /></imageobject>
                    </mediaobject>
                </figure>
            </para>
            <para>We note a few things in <xref xlink:href="#fig.common-objects"/>
                <itemizedlist>
                    <listitem>
                        <para>All graphs will start by including the necessary library files via one
                            or more "require_once" PHP statements</para>
                    </listitem>
                    <listitem>
                        <para>All graph scripts (for 2D linear type graphs) will have the following
                            two method calls</para>
                        <para>
                            <programlisting>$graph = new Graph($width, $height);
$graph->SetScale('...');</programlisting>
                        </para>
                        <para>These two calls create the necessary instance of the core Graph class
                            that represents the entire graph and specifies what scale should be used
                            for the y- and x-axis. In <xref xlink:href="#fig.common-objects"/> we
                            are also using a second -axis so in this case the script will also
                            contain a call to</para>
                        <para>
                            <programlisting>$graph->SetY2Scale('...');</programlisting>
                        </para>
                    </listitem>
                    <listitem>
                        <para>Most graphs will also adjust the left, right, top and bottom margin.
                            In <xref xlink:href="#fig.common-objects"/> the margins are shown with
                            red arrows. The margins are specified with the method</para>
                        <para>
                            <programlisting>$graph->SetMargin($left,$right,$top,$bottom);</programlisting>
                        </para>
                    </listitem>
                    <listitem>
                        <para>All text objects (e.g. graph and axis titles) are instances of the
                            common Text class. This means that the text, font, color are specified
                            in the same way. For example the code to set the title and subtitle in
                            the graph above is</para>
                        <para>
                            <programlisting>$graph->title->SetFont(FF_ARIAL, FS_BOLD, 14);
$graph->title->Set("Using JpGraph Library");
$graph->title->SetMargin(10);

$graph->subtitle->SetFont(FF_ARIAL, FS_BOLD, 10);
$graph->subtitle->Set('(common objects)');</programlisting>
                        </para>
                        <para>In a similar way the code to set the titles of the axis are</para>
                        <para>
                            <programlisting>$graph->xaxis->title->SetFont(FF_ARIAL, FS_BOLD, 10);
$graph->xaxis->title->Set("X-title");

$graph->yaxis->title->SetFont(FF_ARIAL, FS_BOLD, 10);
$graph->yaxis->title->Set("Y-title");</programlisting>
                        </para>
                    </listitem>
                    <listitem>
                        <para>The graph uses a legend in two rows to name each data series. The
                            position of the legend is controlled by the script and in <xref
                                xlink:href="#fig.common-objects"/> we placed it on the right side.
                            It is also possible to in detail to adjust the layout of the names in
                            the data series. For example we could change the layout of the legend to
                            position all the names of the data series in one row as opposed to one
                            column which is the default. The number of columns and/or rows is user
                            settable.</para>
                    </listitem>
                    <listitem>
                        <para>Finally all graphs will end with a call to <code>Stroke()</code> or
                            one of its variants (<code>StrokeCSIM()</code>,
                                <code>StrokeCSIMIMage()</code>). As was described in Part II this
                            will send back the constructed image to the client, usually a
                            browser.</para>
                    </listitem>
                </itemizedlist></para>
            <para>For other types of graphs (for example Gantt charts) some of the above standards
                still apply but since they have a very different usage and layout the instance
                variables will be different.</para>
        </sect1>
        <sect1>
            <title>Common object for Pie Graphs</title>
            <para>For pie plots there are no concepts of axis or scales. Instead Pieplots have a
                size and position within the graph. <xref xlink:href="#fig.common-pie-objects"/>
                shows the common objects for a typical Pie graph</para>
            <para>
                <figure xml:id="fig.common-pie-objects">
                    <title>Commonly used objects in Piegraphs (<uri role="filename"
                            xlink:href="example_src/common-obj-piegraph.html">
                            common-obj-piegraph.php</uri>)</title>
                    <mediaobject>
                        <imageobject><imagedata scale="70"
                                fileref="images/piegraph-obj-overview.png"/></imageobject>
                    </mediaobject>
                </figure>
            </para>
            <para>The following should be noted.</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>Instead of an instance of <code>class Graph</code> and instance of
                                <code>class PieGraph</code> must be used</para>
                        <para>
                            <programlisting>$graph = new PieGraph($width,$height);</programlisting>
                        </para>
                    </listitem>
                    <listitem>
                        <para>The title and subtitle has the same semantics as for cartesian
                            graphs</para>
                    </listitem>
                    <listitem>
                        <para>The pieplot is an instance of the <code>class PiePlot</code> which is
                            given the data to be used in the pieplot as first and only
                            argument</para>
                        <para>
                            <programlisting>$pieplot = new PiePlot($data);</programlisting>
                        </para>
                    </listitem>
                    <listitem>
                        <para>The size of the pieplot radius is given as fractions of the minimum of
                            the width and height of the graph</para>
                    </listitem>
                    <listitem>
                        <para>The position of the center of the pieplot is given as factions (width,
                            height) of the graph</para>
                    </listitem>
                    <listitem>
                        <para>The legend is controlled in the same way as for cartesian graphs by
                            accessing the instance variable "<code>legend</code>". In the Piegraph
                            in <xref xlink:href="#fig.common-pie-objects"/> we have changed the
                            layout of the legend by the two lines</para>
                        <para>
                            <programlisting>$graph->legend->SetPos(0.5,0.97,'center','bottom');
$graph->legend->SetColumns(3);</programlisting>
                        </para>
                        <para>These two method calls adjust the position and the internal layout of
                            the legend. The first line instructs the library to place the legend at
                            a point (defined in fractions of width and height) (0.5, 0.97) and align
                            that point with the (center, bottom) anchor point in the graph box. The
                            second lines specifies the number of columns to use int the
                            legend.</para>
                    </listitem>
                </itemizedlist>
            </para>
        </sect1>
    </chapter>
    <chapter>
        <title>Getting hold of the data to be displayed</title>
        <para>The initial obstacle that must be negotiated is to get hold of the data to be
            displayed since the library itself is completely agnostic to where the data comes from.
            The library will use data supplied in one or more arrays and it is up to the user of the
            library to get hold of the data to populate these arrays with proper data. In principle
            the data can come from one of the following places</para>
        <para>
            <orderedlist>
                <listitem>
                    <para>Hard-coded data in the script. This is the least flexible and can only
                        really be recommended for examples and really static data.</para>
                </listitem>
                <listitem>
                    <para>Data stored in plain text files.</para>
                </listitem>
                <listitem>
                    <para>Data stored in binary format in flat files. </para>
                </listitem>
                <listitem>
                    <para>Data stored in a database</para>
                </listitem>
                <listitem>
                    <para>Data sent to the script via URI parameter passing (either GET or POST HTTP
                        constructs can be used).</para>
                </listitem>
            </orderedlist>
        </para>
        <para>In the following sections we will shortly discuss each of these methods.</para>
        <para>
            <caution>
                <para>The library assumes that the data available in an array that starts with index
                    0</para>
            </caution>
        </para>
        <sect1>
            <title>Static data</title>
            <para>This is the simplest way and consists of only specifying the data in one or
                several usual PHP arrays directly in the graph script. For example to specify data
                for a Pieplot one could use the following constructions</para>
            <para>
                <programlisting>$data = array(1,8,5,4,12,18);
$pieplot = new PiePlot ($data);</programlisting>
            </para>
            <para>This is the method used for all examples under the "<filename>Example/</filename>"
                directory.</para>
        </sect1>
        <sect1>
            <title>Reading data from a file</title>
            <para>The second method in order of complexity is to read the data from plain text
                files. An example on how to use this was shown in <xref
                    xlink:href="#sec.preparing-sunspots-data"/>. The library contains utility
                methods to ease reading of plain textual data in one of the following
                formats:</para>
            <para>
                <orderedlist>
                    <listitem>
                        <para>One column</para>
                    </listitem>
                    <listitem>
                        <para>Two columns</para>
                    </listitem>
                    <listitem>
                        <para>Comma separated values, CSV</para>
                    </listitem>
                </orderedlist>
            </para>
            <para>The utility class to handle this is called <code>Class ReadFileData</code> and
                contains three utility methods corresponding to the list above, they are
                    <code>ReadFileData::From1Col()</code>, <code>ReadFileData::From2Col()</code>,
                    <code>ReadFileData::FromCSV()</code> and
                <code>ReadFileData::FromCSV2()</code>.</para>
            <para>These methods are described shortly below</para>
            <para>
                <variablelist>
                    <varlistentry>
                        <term><code>ReadFileData::From1Col($aFileName, $aCol1)</code></term>
                        <listitem>
                            <para>Reads data from a text file with one column of data and stores in
                                the supplied <code>$aCol1</code> vector.</para>
                            <para>Typical data looks like</para>
                            <para>
                                <programlisting>123
14.5
19.2</programlisting>
                            </para>
                            <para>which would result in </para>
                            <para>
                                <programlisting>$aCol == array(123, 14.5, 19,2)</programlisting>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term><code>ReadFileData::From2Col($aFile, $aCol1, $aCol2, $aSepChar='
                                ')</code></term>
                        <listitem>
                            <para>Reads data from a text file with two columns separated by the
                                specified character.</para>
                            <para>Typical data looks like</para>
                            <para>
                                <programlisting>12,15
13,34
14,27</programlisting>
                            </para>
                            <para>which would result in</para>
                            <para>
                                <programlisting>$aCol1 == array(12,13,14);
$aCol2 == array(15,34,27);</programlisting>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>ReadFileData::FromCSV($aFile,&amp;$aData,$aSepChar=',',$aMaxLineLength=1024)</term>
                        <listitem>
                            <para>This method reads comma separated values from a specified file.
                                The values are all separeted by the specified character. This method
                                can be seen as a generalization of From1Col() method.</para>
                            <para>Typical data looks like</para>
                            <para>
                                <programlisting>12,34,56,18,19.7,55</programlisting>
                            </para>
                            <para>which would result in</para>
                            <para>
                                <programlisting>$aData == array(12,34,56,18,19,7,55)</programlisting>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>ReadFileData::FromCSV2($aFile, &amp;$aData, $aOptions =
                            array())</term>
                        <listitem>
                            <para>This method also reads comma separated values from a file but with
                                more advanced options to control how the data is read. This can be
                                seen as a generalization of From2Col() method.</para>
                            <para>The possible options and there default values for this method
                                are</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para>'separator' => ','</para>
                                    </listitem>
                                    <listitem>
                                        <para>'enclosure' => '"'</para>
                                    </listitem>
                                    <listitem>
                                        <para>'readlength' => 1024</para>
                                    </listitem>
                                    <listitem>
                                        <para>'ignore_first' => false</para>
                                    </listitem>
                                    <listitem>
                                        <para>'first_as_key' => false</para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                            <para>Typical data (using the default values)</para>
                            <para>
                                <programlisting>10,55
12,78
15,98</programlisting>
                            </para>
                            <para>would result in</para>
                            <para>
                                <programlisting>$aData = array(
  0 => array(10,12,15),
  1 => array(55,78,98)
);</programlisting>
                            </para>
                            <para>If 'first_as_key'=>true and the data looks looks like</para>
                            <para>
                                <programlisting>"key","value"
10,55
12,78
15,98</programlisting>
                            </para>
                            <para>the data would instead be read as</para>
                            <para>
                                <programlisting>$aData = array(
  "key"   => array(10,12,15),
  "value" => array(55,78,98)
);</programlisting>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>ReadFileData::FromMatrix($aFile,$aSepChar=' ')</term>
                        <listitem>
                            <para>This method is especially suited o read matrix data from a file
                                for use with the Matrix visualization (described in <xref
                                    xlink:href="#chapter.matrix-graphs"/>). Each line in the file
                                corresponds to one row in the matrix.</para>
                            <para>Typical data can look like</para>
                            <para>
                                <programlisting>13,87,12
15,99,33
19,86,61</programlisting>
                            </para>
                            <para>Which wold return a matrix looking like</para>
                            <para>
                                <programlisting>array( 
  array(13,87,12),
  array(15,99,33),
  array(19,86,61)
);</programlisting>
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </para>
        </sect1>
        <sect1>
            <title>Sending data to a graph script with URI arguments (GET and POST)</title>
            <para>In order to send data between different HTML pages (or to a specific page) there
                are two ways to do this. Either by including the parameters in the URI directly,
                (e.g. <code>http://localhost/mygraph.php?d1=12</code>) or by creating a POST request
                and send to a page. The details of these two methods are discussed below.</para>
            <para>
                <note>
                    <para>There might be some confusion when to use the <code>'&amp;'</code> and
                        when to use <code>'&amp;amp;'</code> to separate variables in GET or POST
                        requests.</para>
                    <para>When writing URL in HTML the string should always be written with a full
                        entity encoding since the <code>'&amp;'</code> is a special character
                        indicating the start of an entity that ends with an <code>';'</code>. So for
                        example writing a URI in a HTML page should look like.</para>
                    <para><filename>&lt;a
                            href="myscript.php?idx=1&amp;amp;start=2009&amp;amp;end=2010"></filename></para>
                    <para>the browser will then correctly convert the URI to single
                            <code>'&amp;'</code> which is what should be sent to the server. When
                        typing URI directly in the browser (or in any plain text file) one should of
                        course always just use a single <code>'&amp;'</code>
                    </para>
                </note>
            </para>
            <para>
                <tip>
                    <para>Use the method <code>http_build_query()</code> to build http queries from
                        an array with keys and values.</para>
                </tip>
            </para>
            <sect2>
                <title>Using GET arguments</title>
                <para>GET arguments are the arguments that can be added as part of the URI. For
                    example as</para>
                <para>
                    <screen>http://localhost/mygraph.php?id=12&amp;start=20081223&amp;end=20090115</screen>
                </para>
                <para>PHP automatically places all given arguments in the "super global" array
                    variable <code>$_GET</code> as an associative array.</para>
                <para>There are a couple of things to note here</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>The values in the argument string in the URI must be URL encoded,
                                this can easily be done with the PHP function
                                    <code>urlencode()</code> (<uri
                                    xlink:href="http://php.net/manual/en/function.urlencode.php">See
                                    PHP Manual</uri>)</para>
                        </listitem>
                        <listitem>
                            <para>When the arguments are read from $_GET the must be un-quoted with
                                a call to <code>urldecode()</code></para>
                        </listitem>
                        <listitem>
                            <para>Some browsers restrict the length of the URI that they will read
                                (typically &lt; 2048bytes) which means that there is a limit on how
                                much data can be send as URI arguments</para>
                        </listitem>
                        <listitem>
                            <para>Some browsers will allow the syntax
                                    <code>"a[0]=10&amp;a[1]=11&amp;a[2]=12"</code> i order to send
                                the array <code>(10,11,12)</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>This way of specifying the argument string is mostly useful when</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>The arguments are short</para>
                        </listitem>
                        <listitem>
                            <para>When the user should be able to bookmark an URI</para>
                        </listitem>
                        <listitem>
                            <para>When the data is not sensitive (since it can be seen in the
                                URI)</para>
                        </listitem>
                        <listitem>
                            <para>When the graph should be viewable by clicking on a link (more on
                                this when we compare the GET method with the POST method
                                below)</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>The "best practice" of using this method is to send a short key (or id) to the
                    graph script and the graph script itself will use this id to extract the real
                    data from a DB (or a plain text file). This way the same core graph script can
                    be used in various context to display wanted data.</para>
            </sect2>
            <sect2>
                <title>Using a POST request</title>
                <para>
                    <warning>
                        <para>This is a fairly advanced topic and it is recommended to use the other
                            methods of sending data to a script unless the specifications explicitly
                            demands that a POST request is constructed. Furthermore this requires a
                            very good understanding of HTTP request headers and the difference
                            between server side and browser side so if you are not sure that you
                            have the necessary background we strongly recommend to stay away from
                            this method.</para>
                    </warning>
                </para>
                <para>Two of the obvious restrictions with the GET method is that <emphasis
                        role="bold">a)</emphasis> the length of the data is restricted and <emphasis
                        role="bold">b)</emphasis> the data is visible directly in the URI. The other
                    way to send data as part of the HTTP request is to use the POST method. </para>
                <para>Unfortunately this is not as easy as just doing some magic and then we get the
                    same functionality as with the GET method. Even some authors get this wrong in
                    some very prominent PHP text books. Unfortunately it will take us too far to
                    discuss all the details of HTTP request headers (as described in <uri
                        xlink:href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">RFC2616</uri>)
                    but we will explain the very basics.</para>
                <para>First. let's state what an HTTP request is</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>A POST HTTP request is used to send data to a specified URI from a
                                client. A client is normally a WEB-browser but can also (as we will
                                use it) be a script that sends the request to the same or to another
                                server. The data is URL encoded and passed in the body of the
                                request. There is no theoretically limit on the length of the
                                data.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>A further common misunderstanding is that it is possible to use the PHP method
                        <code>header()</code> in order to create a POST request. This is even given
                    as an example in the notes to the <code>header()</code> method in the PHP manual
                    (See <uri xlink:href="http://php.net/manual/en/function.header.php">PHP
                        Manual</uri>). This is <emphasis role="bold">wrong</emphasis>. It is
                        <emphasis role="bold">not</emphasis> possible to use the
                        <code>header()</code> method to send a POST header. Trying to do this
                    reveals a basic misunderstanding of the role of a server and client.</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>The <code>header()</code> method is used to send one or more
                                headers from the server <emphasis role="bold">to the
                                    client</emphasis> (i.e. WEB-browser)</para>
                        </listitem>
                        <listitem>
                            <para>The HTTP POST request goes from the client (i.e. WEB-browser)
                                    <emphasis role="bold">to the server</emphasis></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <figure>
                    <title>Post vs. header() data direction</title>
                    <mediaobject>
                        <imageobject><imagedata scale="70" fileref="images/post_vs_header.png"
                            /></imageobject>
                        <caption>
                            <para>Note that the image is greatly simplified to help illustrate the
                                vital point on data direction. For example the post request shown to
                                originate from a browser could originate from any client, for
                                example another script taking the role of a client.</para>
                        </caption>
                    </mediaobject>
                </figure>
                <para>Hence it is never possible to "simulate" a POST call with the use of the
                        <code>header()</code> function. There are basically three (correct) ways to
                    simulate a POST request as described below.</para>
                <para>Before we continue lets first recapitulate the most common use of a POST
                    request, i.e. in a HTML form submission. When data is entered in a form on a
                    HTML page and the user presses the "Submit" button the data from the form is
                    packed as a POST request which is sent to the server at the specified URI (the
                    action URI). The server will the reply back to the POST request (with the data
                    sent back from the target of the post request) and the browser will show the
                    reply in the window in place of the original HTML form page.</para>
                <para>However there is a crucial difference when we do this manually from a script
                    (running on the server) compared with the original form post data from the
                    browser to the server. After issuing a POST request (originating from a HTML
                    form) the browser automatically replaces the current page with the reply from
                    the POST request as a "new" page (by default using the same target window as the
                    request was made from).</para>
                <para>This is not possible to do when sending a "fake" post request to a page since
                    we are not the browser. Instead what we will see in the browser is the page
                        <emphasis role="italic">sending the POST request</emphasis>, and not the
                    target of the post request. The best we can accomplish is to show the reply
                    inline in the calling page which are then shown in the browser.</para>
                <para>This means that it is not possible to create a POST request and then somehow
                    directly show the reply as the resulting image. Instead what we can do is to
                    send the data to a image script (via a POST header) and then the graph script
                    can write the image to a file that is accessible from the server.</para>
                <para>So to summarize. What we can do with a post request is to send the data to a
                    script <filename>b.php</filename> from a script <filename>a.php</filename>. The
                        <filename>b.php</filename> can then execute some statements, for example
                    creating a graph and store it on the server. This stored image can later be read
                    by the <filename>a.php</filename> script, for example via a <tag>&lt;img></tag>
                    tag.</para>
                <para><emphasis role="bold">How to create a POST request</emphasis></para>
                <para>There are in principle three ways of constructing a POST request to send data
                    to a specified URI as shown below. </para>
                <para>After we have made the request (with any of the three methods shown below) the
                    server will reply back with the response created by the URI. This response is
                    any output sent by the script we are sending our request to. Normally this
                    should just be a return code indicating if the request was successful or
                    not.</para>
                <para>Remember that these are calls made from the script <filename>a.php</filename>
                    running on server <emphasis role="bold">A</emphasis> to a script
                        <filename>b.php</filename> running on server <emphasis role="bold"
                        >B</emphasis>. There are no browser involved in these calls apart from the
                    initial request to run <filename>a.php</filename>. The figure below illustrates
                    the first phase when the request is sent to the B side</para>
                <para>
                    <figure>
                        <title>The request phase of a POST header</title>
                        <mediaobject>
                            <imageobject><imagedata scale="70"
                                    fileref="images/post_request_phase1.png"/></imageobject>
                            <caption>
                                <para>1. The request is initially made by calling the a.php script,
                                    e.g. http://localhost/a.php in the browser</para>
                                <para>2. When the a.php script is executed it will create the POST
                                    header and call script b.php o the server B (could possibly be
                                    the same server). Since the browser is displaying script a.php
                                    we can never change that directly but we can display the reply
                                    from b.php in the page displayed by a.php</para>
                            </caption>
                        </mediaobject>
                    </figure>
                </para>
                <figure>
                    <title>The reply phase of a POST request</title>
                    <mediaobject>
                        <imageobject><imagedata scale="70" fileref="images/post_request_phase2.png"
                            /></imageobject>
                        <caption>
                            <para>3. The b.php returns a reply by fir example echoing back a reply
                                code</para>
                            <para>4. The script running the browser receives its final data (which
                                is the reply from the b.php script) and then finish the original
                                request started in step 1.</para>
                        </caption>
                    </mediaobject>
                </figure>
                <para><emphasis role="bold">Note:</emphasis> All the <code>sendPostData_vX()</code>
                    methods below assumes that the data is already urlencoded.</para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para><emphasis role="bold">Create a stream request.</emphasis></para>
                            <para>The advantage with this method is that it is available by default
                                in PHP >= 4.3 and of course in PHP5,6 without the need to install
                                additional libraries.</para>
                            <para>
                                <programlisting>&lt;?php
function sendPostData_v1($url, $data) { 
  $opts = array('http' => array(
    'method' => 'POST', 
    'header' => 
        "Content-type: application/x-www-form-urlencoded\r\n".
        "Content-Length: ".strlen($data)."\r\n".
    'content' => $data,
    ); 
  $stream = stream_context_create($opts); 
  $fp = fopen($url, 'rb', false, $stream); 
  if (!$fp) { // Some error handling } 

  // Find out what the page returns as its body 
  $reply = stream_get_contents($fp); 
  if ($reply === false) { // Some error handling } 

  return $reply; 
} 
?></programlisting>
                            </para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold">Open a socket directly and write to it
                                </emphasis></para>
                            <para>
                                <programlisting>&lt;?php
function sendPostData_v2($url,$data,$port=80) { 
  $errno=-1;
  $errstr=''; 
  $fs = fsockopen($url,$port,$errno,$errstr); 
  if( $fs === false ) { // Some error handling } 

  $header = "POST $url HTTP/1.0\r\n"; 
  $header .= "Content-Type: application/x-www-form-urlencoded\r\n"; 
  $header .= "Content-Length: " . strlen($data) . "\r\n\r\n"; 
  fputs($fs, $header . $data ); 

  // Find out what the page returns as its body 
  $reply = ''; 
  while( !feof($fs) ) { 
    $reply .= fgets($fp,8192); 
  } 
  return $reply; 
} 
?></programlisting>
                            </para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold"> Use CURL to handle all the necessary
                                    details</emphasis></para>
                            <para><emphasis role="bold">Note 1:</emphasis> This requires that curl
                                libraries are installed and that curl is enabled in the PHP
                                installations. </para>
                            <para><emphasis role="bold">Note 2:</emphasis> Depending on the
                                application there might be many more options that needs to be
                                tweaked. The one used below are just the bare necessities.</para>
                            <para><emphasis role="bold">Note 3:</emphasis> Using CURL is the most
                                general way to handle POST requests and simplifies the additional
                                complexity if we want to add encryption (i.e. HTTPS) in the
                                connection handling.</para>
                            <programlisting>&lt;?php
function sendPostData_v3($url,$data)
{
  // Initialize and get the curl handle
  $ch = curl_init();

  // Include possible headers in the reply from the server as well
  curl_setopt( $ch, CURLOPT_HEADER, true );

  // Return the reply as a string from curl_exec() instead of directly to stdout
  curl_setopt( $ch, CURLOPT_RETURNTRANSFER, true );

  // The URI we want to send the post data to
  curl_setopt($ch, CURLOPT_URL, $url);

  // Use the POST method
  curl_setopt($ch, CURLOPT_POST, true);

  // All the data to be sent
  curl_setopt($ch, CURLOPT_POSTFIELDS,$data);

  $reply = curl_exec ($ch);

  curl_close($ch);
  return $reply;
}
?></programlisting>
                        </listitem>
                    </orderedlist>
                </para>
            </sect2>
        </sect1>
        <sect1>
            <title>Reading data from a database</title>
            <para>Since there are so many databases and so many ways to organize data in tables it
                is impossible to give generic examples. Instead we point out some common pitfalls
                when gathering data from a database.</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>Make sure the data is valid numeric data. It is a common mistake to
                            read <code>NULL</code> (or empty strings "") values and try to plot
                            them. Beware that the PHP function <code>empty()</code> also will return
                            true for 0 and "0" values so it is not enough to just test with
                                <code>empty()</code> since this will also remove all values that
                            happens to be valid 0 values. To avoid this use the following modified
                            empty method.</para>
                        <para>
                            <programlisting>function empty0($aValue){
    if ( !is_numeric(trim($aValue)) ) 
        return empty($aValue);
    return false;
} </programlisting>
                        </para>
                    </listitem>
                    <listitem>
                        <para>Some databases (e.g. MySQL) returns a column with decimal type values
                            as string in a SELECT statement which normally is handled by automatic
                            conversion in PHP but since PHP has different interpretation of "0.00"
                            and 0.00 in respect to what is interpreted as empty or not this needs to
                            be carefully handled.</para>
                    </listitem>
                </itemizedlist>
            </para>
        </sect1>
        <sect1>
            <title>Reading binary data from a file</title>
            <para>This can be potentially dangerous since the exact format for the binary data can
                differ depending on convention and system. The advantage is that it usually gives
                smaller data files and is usually not as suspect to data corruption since it is not
                easy to read directly into a text editor and change. In PHP a variable can be stored
                in a binary format using the <code>serialize()</code> function and read back from a
                file with <code>unserialize()</code></para>
            <para>
                <tip>
                    <para>It is also possible to store binary data in a text file as a string. One
                        way of doing this is to do a base64 encoding of the binary data. This will
                        guarantee that the encoded data will only be printable characters which can
                        be stored in a normal string. One thing to remember is that this will
                        enlarge the data by roughly 30%. Another example on when base64 encoding is
                        useful is to store binary images in a text file. This is the way for example
                        all built-in images are stored in the library. The image is the re-created
                        from the string by first decoding the base64 data and then read in the data
                        with the GD function <code>imagecreatefromstring()</code> .</para>
                </tip>
            </para>
        </sect1>
        <sect1 xml:id="sec1.null-value-handling">
            <title>Different types of NULL data handling</title>
            <para>In some data there might be data points missing. For example if some experimental
                data is to be graphed there can be data points where the equipment was faulty and
                not valid values exist. The library offers to way to handle this. </para>
            <para>
                <orderedlist>
                    <listitem>
                        <para>Leave the data point empty and leave a whole in the graph, for example
                            a break in a line plot. This happens iof the null value is specified as
                            either one of the following values</para>
                        <para>
                            <itemizedlist>
                                <listitem>
                                    <para><code>'x'</code> - A single character 'x'</para>
                                </listitem>
                                <listitem>
                                    <para><code>''</code> - An empty string</para>
                                </listitem>
                                <listitem>
                                    <para><code>NULL</code> - The NULL value</para>
                                </listitem>
                            </itemizedlist>
                        </para>
                    </listitem>
                    <listitem>
                        <para>Ignore the data point and connect the previous and next data point
                            with the line in a line graph. This is accomplished by specifying the
                            null value as</para>
                        <para>
                            <itemizedlist>
                                <listitem>
                                    <para><code>'-'</code> - A single hyphen character</para>
                                </listitem>
                            </itemizedlist>
                        </para>
                    </listitem>
                </orderedlist>
            </para>
            <para>In <xref xlink:href="#ex.different-nulls"/> an example with the different types of
                null values are shown. In these graphs the third data point is set to null with the
                two different null values.</para>
            <para>
                <example xml:id="ex.different-nulls">
                    <title>Illustration of different types of NULL values in graphs</title>
                    <informaltable frame="none">
                        <tgroup cols="3">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <colspec colname="c3" colnum="3"/>
                            <tbody>
                                <row>
                                    <entry>
                                        <figure>
                                            <title>Original graph with all values</title>
                                            <mediaobject>
                                                <imageobject><imagedata scale="70"
                                                  fileref="images/nullvalues1.png"/></imageobject>
                                            </mediaobject>
                                        </figure>
                                    </entry>
                                    <entry>
                                        <figure>
                                            <title>Value at x=2 as ''</title>
                                            <mediaobject>
                                                <imageobject><imagedata scale="70"
                                                  fileref="images/nullvalues2.png"/></imageobject>
                                            </mediaobject>
                                        </figure>
                                    </entry>
                                    <entry>
                                        <figure>
                                            <title>Value at x=2 as '-'</title>
                                            <mediaobject>
                                                <imageobject><imagedata scale="70"
                                                  fileref="images/nullvalues3.png"/></imageobject>
                                            </mediaobject>
                                        </figure>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </example>
            </para>
            <para>
                <caution>
                    <para>If all values in a line plot are null values an error will be shown since
                        this is not considered to be a valid plot.</para>
                    <para>
                        <figure xml:id="fig.only-null-error">
                            <title>Error when only null values are specified</title>
                            <mediaobject>
                                <imageobject>
                                    <imagedata scale="70" fileref="images/errmsg-only-null.png"
                                    /></imageobject>
                            </mediaobject>
                        </figure>
                    </para>
                </caution>
            </para>
        </sect1>
        <sect1>
            <title>Troubleshooting input data</title>
            <para>There are two common mistakes that causes problems with input data.</para>
            <para>
                <orderedlist>
                    <listitem>
                        <para>The indexes in the data array has missing keys. The library assumes
                            that the data array has consecutive values indexed from 0 and upwards.
                            This means that the following data array specification is <emphasis
                                role="bold">illegal</emphasis></para>
                        <para>
                            <programlisting>$data = array( 1 => 23, 2 => 14, 3 => 17 ) ;</programlisting>
                        </para>
                        <para>The problem with the array above is that it lacks the 0 key. A similar
                            problem is to have a missing index, such as</para>
                        <para>
                            <programlisting>$data = array( 0 => 23, 2 => 14, 3 => 17 ) ;</programlisting>
                        </para>
                        <para>If <code>E_NOTICE</code> is not enabled in
                                <filename>php.ini</filename> then this mistake will give the
                            (slightly misleading) error message shown in <xref
                                xlink:href="#fig.only-null-error"/>. If full error checking is
                            enabled in php.ini then these types of problem will give the standard
                            PHP error message shown in <xref
                                xlink:href="#fig.php-htmlerr-missing-key"/>. This shows a PHP setup
                            which has HTML errors enabled. Note the JpGraph textual error string at
                            the bottom of the second PHP error message box.</para>
                        <para>
                            <figure xml:id="fig.php-htmlerr-missing-key">
                                <title>PHP (HTML) error when missing data keys</title>
                                <mediaobject>
                                    <imageobject><imagedata scale="70"
                                            fileref="images/php-htmlerr-missing-key.png"
                                        /></imageobject>
                                </mediaobject>
                            </figure>
                        </para>
                    </listitem>
                    <listitem>
                        <para>Another typical mistake caused by "faulty data" is different
                            convention for specifying decimal data. PHP and the library assumes that
                            decimal data used "." (point) to separate the integer from the decimal
                            part of a number. Some locales uses "," (comma) to do this separation.
                            This means that the following code will <emphasis role="bold"
                                >not</emphasis> work.</para>
                        <para>
                            <programlisting>$data = array( 0 => '12,0', 1 => '18,0', 2 => '15,0' ) ;</programlisting>
                        </para>
                        <para>Again, if <code>E_NOTICE</code> is not enabled in
                                <filename>php.ini</filename> then this mistake will give the
                            (slightly misleading) error message shown in <xref
                                xlink:href="#fig.only-null-error"/></para>
                    </listitem>
                </orderedlist>
            </para>
        </sect1>
    </chapter>
    <chapter>
        <title>Common features for all Cartesian (x,y) graph types</title>
        <sect1>
            <title>The definition of linear graphs</title>
            <para>With cartesian graphs we refer to all plots which have orthogonal x and y axis.
                The library support the option of multiple y-scales (when applicable) but only on
                x-axis can be used. </para>
            <para>The following principle linear graph types are supported as of v2.5 (note that
                some graph types may have additional subtypes that are not shown in this
                overview.)</para>
            <para>
                <figure>
                    <title>Supported principle linear graph types in the library</title>
                    <informaltable frame="none">
                        <tgroup cols="3">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <colspec colname="c3" colnum="3"/>
                            <tbody>
                                <row>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_line.png"
                                                /></imageobject></inlinemediaobject></para>
                                        <para>a) Line plot</para>
                                        <para>(See <xref xlink:href="#sec2.creating-line-graph"
                                            />)</para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_area.png"
                                                /></imageobject></inlinemediaobject></para>
                                        <para>b) Area plot</para>
                                        <para>(See <xref xlink:href="#sec2.creating-area-graph"
                                            />)</para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_bar.png"
                                                /></imageobject></inlinemediaobject></para>
                                        <para>c) Bar plot</para>
                                        <para>(See <xref xlink:href="#sec1.creating-bar-graphs"
                                            />)</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_field.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para>a) Field plot</para>
                                        <para>(See <xref xlink:href="#sec1.creating-field-graphs"
                                            />)</para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_error.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para>b) Error plot</para>
                                        <para>(See <xref xlink:href="#sec1.creating-error-graphs"
                                            />)</para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_stock.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para>c) Stock plot</para>
                                        <para>(See <xref xlink:href="#sec1.creating-stock-graphs"
                                            />)</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_geomap.jpg"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para>a) Geo-map plot</para>
                                        <para>(See <xref xlink:href="#sec1.creating-geo-maps"
                                            />)</para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_impuls.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para>b) Impuls (stem) plot</para>
                                        <para>(See <xref xlink:href="#sec1.creating-scatter-graphs"
                                            />)</para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_spline.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para>c) Spline plot</para>
                                        <para xlink:href="#sec2.creating-cubic-splines">(See <xref
                                                xlink:href="#sec2.creating-cubic-splines"/>)</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_balloon.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para>a) Balloon plot</para>
                                        <para>(See <xref xlink:href="#sec1.creating-balloon-graphs"
                                            />)</para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_scatter.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para>b) Scatter plot</para>
                                        <para>(See <xref xlink:href="#sec1.creating-scatter-graphs"
                                            />)</para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/ploticon_contour.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para>c) Contour plot</para>
                                        <para>(See <xref xlink:href="#sec.contour-graphs"/>)</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </figure>
            </para>
            <para>Each of these graph types have there own section where more details can be found
                by following the link under the corresponding graph icon.</para>
            <sect2>
                <title>Axis and coordinate systems</title>
                <para>The x and y axis each in a graph has an associated scale, labels, titles, grid
                    lines, colors and position. The axis properties are accessed as objects of the
                    axis instance variables in the main graph class. The axis can be access vi the
                    following instance variables.</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Graph::xaxis</code>, The x-axis, (by default on the
                                bottom)</para>
                        </listitem>
                        <listitem>
                            <para><code>Graph::yaxis</code>, The y-axis, (by default on the left
                                side)</para>
                        </listitem>
                        <listitem>
                            <para><code>Graph::y2axis</code>, The second y-axis (by default on the
                                right side)</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>In addition the library also supports the use of multiple y-axis and they are
                    accessed via an instance array</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Graph::ynaxis[]</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>All axis in turn are instances of <code>class Axis</code> and hence share
                    common properties. The only two property that can be publicly accessed on the
                    axis are</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::scale</code>. The scale of the axis. An instance of
                                either <code>LinearScale</code>, <code>LogScale</code> or
                                    <code>DateScale</code>. This rarely needs to be accessed
                                directly.</para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::title</code>. The axis title. On the x-axis this is
                                horizontal by default and on the y-axis the title is vertical by
                                default</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>On the other hand there are a large amount of methods that can be used on the
                    axis to adjust various properties. Some examples of commonly used methods are
                    given below. The full description of each method is given in the API
                    reference.</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>Adjusting the labels</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>Axis::SetLabelFormatString($aFormStr,$aDateFormat=false)</code>.
                                            Specifies the labels format string assuming
                                                <code>printf()</code> format if <code>$aDate</code>
                                            is false and in <code>date()</code> format if
                                                <code>$aDate</code> is true.</para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetLabelFormatCallback($aCallbackFunc)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetLabelAlign($aHorAlign, $aVertAlign='top',$aParagraphAlign='left')</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::HideLabels($aHide=true)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetTicklabels($aLabels, $aLabelColors=null)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetLabelMargin($aMargin)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetLabelSide($aSide)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetFont($aFamily,$aStyle=FS_NORMAL,$aSize=10)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetLabelAngle($aAngle)</code>. Species the
                                            angle of the label. <emphasis role="bold"
                                                >Note:</emphasis> It is only possible to use
                                            arbitrary angles if the font is a true type font. The
                                            built in bit map fonts only supports 0 and 90 degree
                                            text strings.</para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                        <listitem>
                            <para>Adjusting the tick marks</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>Axis::SetTickSide($aSide)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetTickPositions($aMajPos,$aMinPos=NULL,$aLabels=NULL)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::HideTicks($aHide)</code></para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                        <listitem>
                            <para>Adjusting the actual axis</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>Axis::HideLine($aHide=true)</code>, ONly hide
                                            the axis but whos the labels</para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::Hide($aHide)</code>, Hide both axis and
                                            labels</para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetWeight($aWeight)</code>, Set the weight
                                            in pixels of the axis</para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetPos($aPositionOnOtherScale)</code>
                                            Specifies the position of the axis on the other scale.
                                            The position is given the scale of the other axis. There
                                            are two special values (strings) that can be given and
                                            those are </para>
                                        <para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para><code>'min'</code> - Will position the axis
                                                  at the minimum value of the other scale</para>
                                                </listitem>
                                                <listitem>
                                                  <para><code>'max'</code> - Will position the axis
                                                  at the maximum value of the other scale</para>
                                                </listitem>
                                            </itemizedlist>
                                        </para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                        <listitem>
                            <para>Adjusting the title</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>Axis::SetTitle($aTxt)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetTitleMargin($aMargin)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetTitleSide($aSide)</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Axis::SetColor($aColor,$aLabelColor)</code></para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>The above methods are valid for all possible axis. So for example the
                    following line sets the font for the labels on the x-axis </para>
                <para>
                    <programlisting>$graph->xaxis->SetFont(FF_ARIAL,FS_NORMAL,12);</programlisting>
                </para>
                <para>and the follwing code set the font for the y-axis</para>
                <para>
                    <programlisting>$graph->yaxis->SetFont(FF_ARIAL,FS_NORMAL,12);</programlisting>
                </para>
            </sect2>
            <sect2>
                <title>Adjusting the axis look and feel</title>
                <para>The two major ways to adjust the look and feel of the axis are adjustments of
                    the color and the weight (i.e. width) and this can be done with the appropriate
                    methods as described above.</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::SetColor($aColor,$aLabelColor)</code>, For example
                                    <code>$graph->xaxis->SetColor('teal')</code>. Please note that
                                by default the color for the labels will be that of the line if the
                                label color is not explicitly specified.</para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::SetWeight($aWeight)</code>. Specify the weight (in
                                pixels of the axis)</para>
                        </listitem>
                    </itemizedlist>
                </para>
            </sect2>
            <sect2>
                <title>Adding grid lines in the plot</title>
                <para>
                    <note>
                        <para>The possibility of a having different styles, colors and weight for
                            minor and major grid lines was added in 3.0.4 and is not available in
                            earlier releases.</para>
                    </note>
                </para>
                <para>Grid lines will make it easier to see where the data points are in the graph.
                    The grid lines are access by the properties "<code>xgrid</code>" and
                        "<code>ygrid</code>"of the Graph class. By default only the y-axis grid are
                    enabled by default. The following code example enables the major grids for both
                    the x- and y-axis.</para>
                <para>
                    <programlisting>$graph_>xgrid->Show();
$graph->ygrid->Show();</programlisting>
                </para>
                <para>The grid lines are instances of <code>Class Grid</code>. and supports the
                    following methods</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Grid::SetColor($aMajColor,$aMinColor=false)</code>. Specify
                                the color for the major an minor grid lines</para>
                        </listitem>
                        <listitem>
                            <para><code>Grid::SetWeight($aMajorWeight,$aMinorWeight=1)</code>.
                                Specify the weight of the line for the major and minor grid
                                line</para>
                        </listitem>
                        <listitem>
                            <para><code>Grid::Show($aMajGid=true,$aMinGrid=false)</code>. Determine
                                which grid lines should be shown</para>
                        </listitem>
                        <listitem>
                            <para><code>Grid::SetLineStyle($aMajorType,$aMinorType)</code> This
                                method makes it possible to adjust the line style of the grid lines
                                (both major and minor separately). The line style is specified as a
                                string and can have one of the following values</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>"solid"</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>"dotted"</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>"dashed"</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>"longdashed"</code></para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                        <listitem>
                            <para><code>Grid::SetFill($aFlg=true,$aColor1='lightgray',$aColor2='lightblue')</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>The last method needs an explanation. The fill refers to the possibility to
                    fill the space between the grid lines with alternating colors as specified in
                    the method call. <xref xlink:href="#fig.filledgridex1"/> shows an example on how
                    this can be used to make it easier to read a plot.</para>
                <para>
                    <programlisting>#=filledgridex1|Using alternating fill colors in the grid#</programlisting>
                </para>
                <para>In the above example we have also used the possibility of using alpha-blending
                    (for example on the shadow on the legend box).</para>
                <para>The example below shows how to use different styles for the major and minor
                    grid lines</para>
                <para>
                    <programlisting>#=gridstylesex1|Using different grid styles for major and minor grids#</programlisting>
                </para>
            </sect2>
            <sect2 xml:id="sec2.predef-axis-setup">
                <title>Predefined scientific axis setups</title>
                <para>In order to make it easier to setup a couple of typical axis configuration
                    used in science plots there are four predefined configurations as shown in <xref
                        xlink:href="#fig.predefined-axis-pos"/>. </para>
                <para>
                    <figure xml:id="fig.predefined-axis-pos">
                        <title>Predefined scientific axis positions </title>
                        <informaltable frame="none">
                            <tgroup cols="4">
                                <colspec colname="c1" colnum="1"/>
                                <colspec colname="c2" colnum="2"/>
                                <colspec colname="c3" colnum="3"/>
                                <colspec colname="c4" colnum="4"/>
                                <tbody>
                                    <row>
                                        <entry>
                                            <mediaobject>
                                                <imageobject><imagedata scale="70"
                                                  fileref="images/img_mmaxis3.png"/></imageobject>
                                            </mediaobject>
                                        </entry>
                                        <entry>
                                            <mediaobject>
                                                <imageobject><imagedata scale="70"
                                                  fileref="images/img_mmaxis4.png"/></imageobject>
                                            </mediaobject>
                                        </entry>
                                        <entry>
                                            <mediaobject>
                                                <imageobject><imagedata scale="70"
                                                  fileref="images/img_mmaxis9.png"/></imageobject>
                                            </mediaobject>
                                        </entry>
                                        <entry>
                                            <mediaobject>
                                                <imageobject><imagedata scale="70"
                                                  fileref="images/img_mmaxis10.png"/></imageobject>
                                            </mediaobject>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry><code>AXSTYLE_BOXOUT</code></entry>
                                        <entry><code>AXSTYLE_BOXIN</code></entry>
                                        <entry><code>AXSTYLE_YBOXIN</code></entry>
                                        <entry><code>AXSTYLE_YBOXOUT</code></entry>
                                    </row>
                                </tbody>
                            </tgroup>
                        </informaltable>
                    </figure>
                </para>
                <para>The styles can easily be setup with a call to the method</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Graph::SetAxisStyle($aStyle)</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>An example of using this setup of the axis is shown in <xref
                        xlink:href="#fig.funcex2"/></para>
                <para>
                    <programlisting>#=funcex2|Example of <code>AXSTYLE_BOXIN</code> axis style#</programlisting>
                </para>
            </sect2>
            <sect2 xml:id="sec2.possible-axis-position">
                <title>Other possible ways to position the axis</title>
                <para>The axis can be manually positioned with a call to</para>
                <para><code>Axis::SetPos($aPos)</code></para>
                <para>The argument <code>$aPos</code> is normally the coordinate position on the
                    "other" axis where the crossing of this and the other axis should be. There are
                    also two special positions which are given as strings. They are
                        <code>'min'</code> and <code>'max'</code>. Not surprisingly these special
                    positions will always refer to the min and max scale value of the other
                    axis.</para>
                <para>The position given is the scale position on the "other"axis, i.e. for the
                    x-axis the position specifies the crossing of the y-axis and vice versa.</para>
                <para>Since it is possible to manually specify all aspects of the axis the table
                    below shows some typical common setups and the principle calls needed to achieve
                    the illustrated affect.</para>
                <para>
                    <table frame="all">
                        <title>Axis configurations</title>
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <tbody>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmaxis1.png"
                                                /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry valign="top">
                                        <para>This is the default setup and not extra configurations
                                            are needed and it is the same as</para>
                                        <para>
                                            <programlisting>$graph->SetAxisStyle(AXSTYLE_SIMPLE);</programlisting>
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmaxis1top.png"
                                                  /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry valign="top">
                                        <para>This setup is configured by moving the x-axis to the
                                            top</para>
                                        <para>
                                            <programlisting>$graph->xaxis->SetPos('max');
$graph->xaxis->SetLabelSide(SIDE_UP);
$graph->xaxis->SetTickSide(SIDE_DOWN);</programlisting>
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmaxis5.png"
                                                /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry valign="top">
                                        <para>This is the standard style but with an added box
                                            around the plot area.</para>
                                        <para>
                                            <programlisting>$graph->SetAxisStyle(AXSTYLE_SIMPLE);
$graph->SetBox();</programlisting>
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmaxis1topbox.png"
                                                  /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry valign="top">
                                        <para>
                                            <programlisting>$graph->xaxis->SetPos('max');
$graph->xaxis->SetLabelSide(SIDE_UP);
$graph->xaxis->SetTickSide(SIDE_DOWN);
$graph->SetBox();</programlisting>
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmaxis2.png"
                                                /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry valign="top">
                                        <para>This configuration locks the x- and y-axis at the
                                            origin</para>
                                        <para>
                                            <programlisting>$graph->xaxis->SetPos(0);
$graph->yaxis->SetPos(0);</programlisting>
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmaxis6.png"
                                                /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry valign="top">
                                        <para>With an added box around the plot area</para>
                                        <para>
                                            <programlisting>$graph->xaxis->SetPos(0);
$graph->yaxis->SetPos(0);
$graph->SetBox();</programlisting>
                                        </para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>
            </sect2>
        </sect1>
        <sect1 xml:id="sec.overall-graph-formatting">
            <title>Specifying and formatting the overall displayed graph</title>
            <para>The overall look and feel of the graph can be adjusted in a number of ways.</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>color of the plot area</para>
                    </listitem>
                    <listitem>
                        <para>color of the margin</para>
                    </listitem>
                    <listitem>
                        <para>size of the margin (and hence the position of the plot area)</para>
                    </listitem>
                    <listitem>
                        <para>title(s) of the graph, a graph can have both a "title", "subtitle" and
                            a "subsubtitle"</para>
                    </listitem>
                    <listitem>
                        <para>drop shadow around the graph</para>
                    </listitem>
                    <listitem>
                        <para>adding how long time it took to generate the graph</para>
                    </listitem>
                </itemizedlist>
            </para>
            <sect2>
                <title>Adjusting size, margins and frame</title>
                <para>The overall size of the graph is specified in the initial creation of the
                        "<code>$graph</code>" instance. This is mandatory. </para>
                <para>
                    <programlisting>$graph = new Graph($width,$height);</programlisting>
                </para>
                <para>The margin determines the space between the edges of the plotarea and edge of
                    the graph. Please note that the edge does not include the frame around the
                    entire graph area, i.e. whatever weight the frame edge has it doesn't impact on
                    the margin area. The margin is specified in the order left,right,top and bottom
                    margin and the size is specified in pixels.</para>
                <para>
                    <programlisting>$graph->SetMargin(30,10,40,20);</programlisting>
                </para>
                <para>The default margin will be as narrow as possible but still have enough space
                    to show the titles and labels. The final adjustments is wheter or not the graph
                    will have a frame or not. There are two distinctions to be made here. No frame
                    meaning that the margin area will not be colored (i.e. painted) and no frame as
                    in no edge around the graph area. The first case is achieved by calling the
                        <code>SetFrame()</code> method on the Graph class</para>
                <para>
                    <programlisting>$graph->SetFrame(false);</programlisting>
                </para>
                <para>and the second case is achieved by setting the frame edge to have weight zero.
                    Since the weight is given as the third argument we wtill have to put in valid
                    "dummy" argument for the on/off flag and the frame color parameter.</para>
                <para>
                    <programlisting>$graph->SetFrame(true,'black',0);</programlisting>
                </para>
                <para>Refer to <xref xlink:href="#fig.common-objects"/> for definitoin of plot aea
                    and margin.</para>
            </sect2>
            <sect2>
                <title>Adding drop shadow to the graph</title>
                <para>A graph can have a drop shadow specified with the method
                        <code>SetShadow()</code> which has the signature</para>
                <para>
                    <programlisting>SetShadow($aShowShadow=true,$aShadowWidth=5,$aShadowColor=array(102,102,102))</programlisting>
                </para>
                <para>by default there will be no dropshadow. Note that the drop shadow is a
                    straight simple shadow and has no Gaussian blur.</para>
            </sect2>
            <sect2 xml:id="sec2.fomratting-graph-titles">
                <title>Formatting and specifying the titles of the graph</title>
                <para>There are three possible standard titles in the graph</para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para><code>$graph->title</code></para>
                        </listitem>
                        <listitem>
                            <para><code>$graph->subtitle</code></para>
                        </listitem>
                        <listitem>
                            <para><code>$graph->subsubtitle</code></para>
                        </listitem>
                    </orderedlist>
                </para>
                <para>Each title is an instance of the Text class which means it supports the
                    standard text adjusting methods <code>SetFont()</code>, <code>Set()</code>,
                        <code>SetColor()</code> etc. The title s will be centered on the top of the
                    graph area with the title highest up, subtitle below and finally the subsubtitle
                    below that as shown in <xref xlink:href="#fig.titleex1"/></para>
                <para>
                    <programlisting>#=titleex1|The various titles in a graph#</programlisting>
                </para>
                <para>In addition to the above standard titles there is also another type of graph
                    titles called the "Tabular title". This is a title that sits directly on the
                    plot area looking like a "tab" in a sorting cabinet. <xref
                        xlink:href="#fig.gradbkgex1"/> and <xref xlink:href="#fig.imgmarkerex1"/>
                    shows examples of this.</para>
                <para>
                    <informaltable frame="none">
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="newCol2" colnum="2"/>
                            <tbody>
                                <row>
                                    <entry>
                                        <programlisting>#=gradbkgex1|Tabtitle and gradient background#</programlisting>
                                    </entry>
                                    <entry>
                                        <programlisting>#=imgmarkerex1|Tabtitle and image marker in a line plot#</programlisting>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </para>
                <para>These type of titles are created by using the </para>
                <para>
                    <programlisting>$graph->tabtitle</programlisting>
                </para>
                <para>property in the Graph class. For example the tabtitle in <xref
                        xlink:href="#fig.barlinealphaex1"/> was generated by adding the lines</para>
                <para>
                    <programlisting>$graph->tabtitle->Set('Year 2003');
$graph->tabtitle->SetFont(FF_ARIAL,FS_BOLD,10);</programlisting>
                </para>
                <sect3>
                    <title>Adding special background to the title</title>
                    <para>There is one more way to make the graph title stand out that. This feature
                        is probably one of the least known ways to adjust the graph title and is
                        used to put a lot of emphasis on the title by having a separate color (and
                        style) for the background of the graph title.</para>
                    <para>
                        <note>
                            <para>This feature was added by the request of one of our users who had
                                a company design policy that demanded these type sof formatting
                                options for graphs.</para>
                        </note>
                    </para>
                    <para>The two methods used to control this style are</para>
                    <para>
                        <itemizedlist>
                            <listitem>
                                <para><code>Graph::SetTitleBackground($aBackColor='gray',
                                        $aStyle=TITLEBKG_STYLE1, $aFrameStyle=TITLEBKG_FRAME_NONE,
                                        $aFrameColor='black', $aFrameWeight=1, $aBevelHeight=3,
                                        $aEnable=true)</code></para>
                                <para>This method is the basic method to specify a solid color
                                    background with the defined style and type of framing. The first
                                    style paramatere specifies the extension of the background and
                                    how it interacts with the frame around the image.</para>
                                <para>
                                    <itemizedlist>
                                        <listitem>
                                            <para><code>TITLEBKG_STYLE1</code>, The title frame will
                                                be drawn inside the overall graph frame</para>
                                        </listitem>
                                        <listitem>
                                            <para><code>TITLEBKG_STYLE2</code>, The title frame will
                                                extend all the way to the edge of the graph and
                                                overwrite any graph frame</para>
                                        </listitem>
                                        <listitem>
                                            <para><code>TITLEBKG_STYLE3</code>, This is the same as
                                                TITLEBKG_STYLE2 apart from when it is used together
                                                with framestyle TITLEBKG_FRAME_BEVEL then the bevel
                                                frame border is on top of the title frame
                                                border</para>
                                        </listitem>
                                    </itemizedlist>
                                </para>
                            </listitem>
                            <listitem>
                                <para><code>Graph::SetTitleBackgroundFillStyle($aStyle,$aColor1='black',$aColor2='white')</code></para>
                                <para>The method determines adjusts the way the background of the
                                    title is filled by allowing a simple pattern filling to be set.
                                    This pattern filling is either horizontal or vertical stripes
                                    (lines) with user selectable colors. The possible patterns
                                    are</para>
                                <para>
                                    <itemizedlist>
                                        <listitem>
                                            <para><code>TITLEBKG_FILLSTYLE_HSTRIPED</code>, The
                                                background will have horizontal stripes with
                                                  <code>$aColor1</code> on a background with
                                                  <code>$aColor2</code></para>
                                        </listitem>
                                        <listitem>
                                            <para><code>TITLEBKG_FILLSTYLE_HSTRIPED</code>, The
                                                background will have vertical stripes with
                                                  <code>$aColor1</code> on a background with
                                                  <code>$aColor2</code></para>
                                        </listitem>
                                        <listitem>
                                            <para><code>TITLEBKG_FILLSTYLE_SOLID</code>, The
                                                background will only have one color specified as
                                                  <code>$aColor1</code></para>
                                        </listitem>
                                    </itemizedlist>
                                </para>
                            </listitem>
                        </itemizedlist>
                    </para>
                    <para>To better show the effect of the possible combinations the table below
                        shows a matrix of the possible combinations and the resulting styles. To
                        keep the table small only the relevant top are of the graph with the title
                        is shown.In addition to keep the style simple we have only used shades of
                        gray.</para>
                    <para>
                        <informaltable frame="none">
                            <tgroup cols="4">
                                <colspec colname="c1" colnum="1"/>
                                <colspec colname="c2" colnum="2"/>
                                <colspec colname="c3" colnum="3"/>
                                <colspec colname="c4" colnum="4"/>
                                <tbody>
                                    <row>
                                        <entry><emphasis role="bold">Frame/Fill
                                            style</emphasis></entry>
                                        <entry>
                                            <para><code>TITLEBKG_FILLSTYLE_HSTRIPED</code></para>
                                        </entry>
                                        <entry>
                                            <para><code>TITLEBKG_FILLSTYLE_VSTRIPED</code></para>
                                        </entry>
                                        <entry>
                                            <para><code>TITLEBKG_FILLSTYLE_SOLID</code></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE1,</para>
                                            <para>TITLEBKG_FRAME_NONE</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground00.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground01.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground02.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE2,</para>
                                            <para>TITLEBKG_FRAME_NONE</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground10.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground11.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground12.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE3,</para>
                                            <para>TITLEBKG_FRAME_NONE</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground20.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground21.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground22.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE1,</para>
                                            <para>TITLEBKG_FRAME_FULL</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground30.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground31.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground32.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE2,</para>
                                            <para>TITLEBKG_FRAME_FULL</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground40.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground41.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground42.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE3,</para>
                                            <para>TITLEBKG_FRAME_FULL</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground50.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground51.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground52.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE1,</para>
                                            <para>TITLEBKG_FRAME_BOTTOM</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground60.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground61.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground62.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE2,</para>
                                            <para>TITLEBKG_FRAME_BOTTOM</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground70.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground71.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground72.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE3,</para>
                                            <para>TITLEBKG_FRAME_BOTTOM</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground80.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground81.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground82.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE1,</para>
                                            <para>TITLEBKG_FRAME_BEVEL</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground90.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground91.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground92.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE2,</para>
                                            <para>TITLEBKG_FRAME_BEVEL</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground100.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground101.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground102.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>TITLEBKG_STYLE3,</para>
                                            <para>TITLEBKG_FRAME_BEVEL</para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground110.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground111.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/titlebackground112.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                </tbody>
                            </tgroup>
                        </informaltable>
                    </para>
                    <note>
                        <para>There is a change in the behaviour of the latest GD library that
                            causes style 2 and style 3 in JpGraph 2.x to be more or less visually
                            identical as can be seen above. Using 1.x will more clearly show the
                            difference. The reason is that with JpGraph 2.x we rely more heavily on
                            the GD built in functions while in 1.x many of the functions where
                            instead implemented in the library (since they weren't earlier available
                            in GD 1.x). The change in JpGraph 2.x was made to increase the
                            performance, unfortunately some minor differences exist in the way GD
                            2.x handles border line cases as how to handle pixel-by-pixel accuracy
                            (or convention). Over time these changes will become less and less as
                            parts of the library will be adjusted to the new GD 2.x
                            behaviour.</para>
                        <para>A typical example of changed behaviour is how rectangles with
                            thickness > 1 are positioned. The library assumes that the top left
                            (0,0) corner is the very top left part of the rectangle. This is not so
                            with GD 2.x. Instead (0,0) is the center point on the line. If the line
                            has thickness=1 they are identical but not if the line has a thickness >
                            1</para>
                    </note>
                </sect3>
            </sect2>
            <sect2>
                <title>Specifying the image format to use</title>
                <para>As described in <xref xlink:href="#sec.sys-req"/> the actual image compression
                    available depends on the system setup. Assuming the needed sewtup is done then
                    the image format can be specified by using the method
                        <code>Graph::SetImgFormat()</code> and specifying the wanted format as a
                    string. For example as</para>
                <para>
                    <programlisting>$graph->SetImgFormat('jpg',80);</programlisting>
                </para>
                <para>The method call above selects JPEG image compression algorithm and tells the
                    algorithm to set the quality parameter to 80%. This additional parameter is only
                    applicable together with JPG formatting.</para>
            </sect2>
            <sect2>
                <title>Generic line formatting</title>
                <para>Any lines in the library can have a number of formatting option. Attributes
                    that can be adjusted are</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>Lineweight (thickness). The weight is specified in pixels and can
                                be any integer values</para>
                        </listitem>
                        <listitem>
                            <para>Linestyle , (dashed, dotted, solid etc). The style is specified as
                                a string using the line method <code>SetLineStyle()</code>. </para>
                            <para>The available line styles are</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para>'solid', A solid line</para>
                                    </listitem>
                                    <listitem>
                                        <para>'dotted', A line with dots</para>
                                    </listitem>
                                    <listitem>
                                        <para>'dashed', A line with short hyphens</para>
                                    </listitem>
                                    <listitem>
                                        <para>'longdashed', A line with long hyphens</para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                            <para>For example to following method call set the y-grid to use the
                                "dotted" style</para>
                            <para>
                                <programlisting>$graph->ygrid->SetLineStyle('dotted');</programlisting>
                            </para>
                            <para>The image in <xref xlink:href="#fig.different-line-styles"/> shows
                                example of different line formatting styles</para>
                            <para>
                                <figure xml:id="fig.different-line-styles">
                                    <title>Different line formatting</title>
                                    <informaltable frame="none">
                                        <tgroup cols="3">
                                            <colspec colname="c1" colnum="1"/>
                                            <colspec colname="c2" colnum="2"/>
                                            <colspec colname="c3" colnum="3"/>
                                            <tbody>
                                                <row>
                                                  <entry>
                                                  <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/linestyle_standard.png"
                                                  /></imageobject></inlinemediaobject></para>
                                                  <para>Standard</para>
                                                  </entry>
                                                  <entry>
                                                  <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70"
                                                  fileref="images/linestyle_antialias.png"
                                                  /></imageobject></inlinemediaobject></para>
                                                  <para>Anti-aliased</para>
                                                  </entry>
                                                  <entry>
                                                  <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/linestyle_thick.png"
                                                  /></imageobject></inlinemediaobject></para>
                                                  <para>Thick (3 pixels)</para>
                                                  </entry>
                                                </row>
                                                <row>
                                                  <entry>
                                                  <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/linestyle_dashed.png"
                                                  /></imageobject></inlinemediaobject></para>
                                                  <para>Dashed</para>
                                                  </entry>
                                                  <entry>
                                                  <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/linestyle_longdash.png"
                                                  /></imageobject></inlinemediaobject></para>
                                                  <para>Long-dash</para>
                                                  </entry>
                                                  <entry>
                                                  <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/linestyle_dotted.png"
                                                  /></imageobject></inlinemediaobject></para>
                                                  <para>Dotted</para>
                                                  </entry>
                                                </row>
                                            </tbody>
                                        </tgroup>
                                    </informaltable>
                                </figure>
                            </para>
                        </listitem>
                        <listitem>
                            <para>Color. The line color is (as usual) adjusted with the method
                                    <code>SetColor()</code>.</para>
                            <para>For example the following line sets the color of the x-grid to
                                lightblue.</para>
                            <para>
                                <programlisting>$graph->xgrid->SetColor('lightblue');</programlisting>
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>
                <note>
                    <para>If anti-aliasing is enabled (see ??.) then all line weights will always be
                        interpreted as having weight 1 regardless.</para>
                </note>
                <para>
                    <tip>
                        <para>To avoid drawing a line set the line weight to 0</para>
                    </tip>
                </para>
            </sect2>
            <sect2 xml:id="sec.adding-footer">
                <title>Adding a footer to the graph</title>
                <para>It is possible to add a footer to the graph as well. The footer can have a
                    left, center and right part. The footer is accessed trough the footer property
                    of the Graph class and its three parts "left", "right" and "center". These parts
                    are instances of the <code>Text</code> class and hence all normal text
                    formatting c an be applied to each part of the footer. The following code
                    snippet shows how the footer parts can be set.</para>
                <para>
                    <programlisting>$graph->footer->left->Set('Left footer');
                        $graph->footer->center->Set('Center footer');
                        $graph->footer->right->Set('Right footer');</programlisting>
                </para>
                <para>An example of using a footer is shown in <xref xlink:href="#fig.footerex1"
                    /></para>
                <para>
                    <figure>
                        <title>Using a footer in a graph</title>
                        <programlisting>#=footerex1|Adding a left,right and center footer#</programlisting>
                    </figure>
                </para>
            </sect2>
            <sect2>
                <title>Adding timing of graphs</title>
                <para>The footer in the bottom of the graph can also be used to show an
                    approximative timing of the graph generation. This is done with the help of
                        <code>class JpgTimer</code>. This timer class offers two methods</para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para><code>JpgTimer::Push()</code>, Starts a new timer and puts it at
                                the top of the timer stack</para>
                        </listitem>
                        <listitem>
                            <para><code>JpgTimer::Pop()</code>, Pops the timer at the top of the
                                stack and returns the time (in ms) since the timer was pushed</para>
                        </listitem>
                    </orderedlist>
                </para>
                <para>(The stack based design makes it possible to have multiple timers running at
                    the same time without interfering each other.)</para>
                <para>The footer class (<xref xlink:href="#sec.adding-footer"/>) have a special
                    provision to handle an instance of the timer class</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Footer::SetTimer($aTimer,$aSuffix='')</code></para>
                            <para><code>$aTimer</code>, an instance of JpgTimer</para>
                            <para><code>$aSuffix</code>, an optional suffix string that will be
                                added at the end of the timing value</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>At the end of the graph generation the specified timer will be sent the sign
                    pop and the resulting timer value will be stored in the right footer of the
                    graph (appended to any previous value in the footer). For example the following
                    simple lines would time the graph generation.</para>
                <para>
                    <programlisting>&lt;?php
// Create a new timer instance
$timer = new JpgTimer();

// Start the timer
$timer->Push();

// Create the graph. These two calls are always required
$graph = new Graph(300,200);
$graph->SetScale("textlin");

// Make the bottom margin large enough to hold the timer value
$graph->SetMargin(40,20,20,60);

$graph->title->Set("Timing a graph");
$graph->footer->right->Set('Timer (ms): ');
$graph->footer->right->SetFont(FF_COURIER,FS_ITALIC);
$graph->footer->SetTimer($timer);

// The rest of the script as normal ..</programlisting>
                </para>
                <para>
                    <note>
                        <para>Remember to make the bottom margin large enough.</para>
                    </note>
                </para>
                <para><xref xlink:href="#fig.example11"/> shows an example of using a timer to add
                    the time (in ms) it took to generate the graph</para>
                <para>
                    <programlisting>#=example11|Adding a timer to the graph (in the footer)#</programlisting>
                </para>
            </sect2>
        </sect1>
        <sect1>
            <title>Adjusting the look and feel of the plot area</title>
            <para>The graph area can be divided in two parts.</para>
            <para>
                <orderedlist>
                    <listitem>
                        <para>The margin area</para>
                    </listitem>
                    <listitem>
                        <para>The plot area</para>
                    </listitem>
                </orderedlist>
            </para>
            <para>These areas can have individual background colors as well as edges of user
                settable size and color. In addition it is possible to use an image as background
                with different formatting options.</para>
            <sect2>
                <title>Plot area and margin areas</title>
                <para>The plot area is where the plot is drawn and the margin area is everything
                    outside. Methods that affect the format of the plot area are</para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para><code>Graph::SetMargin() </code>, This will adjust the size (and
                                position) of the plot area</para>
                        </listitem>
                        <listitem>
                            <para><code>Graph::SetBox($aDrawPlotFrame=true,$aPlotFrameColor=array(0,0,0),$aPlotFrameWeight=1)</code>,
                                This will adjust tyhe format of the edge around the plot area. By
                                default this is disabled.</para>
                        </listitem>
                    </orderedlist>
                </para>
                <para>In a similar way the margin areas peroperties can be adjusted with the
                    methods</para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para><code>Graph::SetMargin()</code> , same as above </para>
                        </listitem>
                        <listitem>
                            <para><code>Graph::SetMarginColor($aColor)</code></para>
                        </listitem>
                        <listitem>
                            <para><code>Graph::SetFram($aDrawImgFrame=true,$aImgFrameColor=array(0,0,0),$aImgFrameWeight=1)</code></para>
                        </listitem>
                        <listitem>
                            <para><code>Graph::SetFrameBevel($aDepth=3,$aBorder=false,$aBorderColor='black',$aColor1='white@0.4',$aColor2='darkgray@0.4',$aFlg=true)</code></para>
                        </listitem>
                    </orderedlist>
                </para>
            </sect2>
            <sect2>
                <title>Clipping to the plot area</title>
                <para>When auto scaling is used no data points will ever be outside the plot area
                    since the scaling will make sure it covers the dynamic range of the data.
                    However, when setting the scale manually there is always the risk that some data
                    points are outside the specified scale. This could then lead to the result shown
                    in <xref xlink:href="#fig.clipping_ex1"/> To avoid this situation it is possible
                    to enable clipping to the plot region by calling the method</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Graph::SetClipping($aFlg)</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>This will "cut away" all parts of the plot that would otherwise be stroked
                    outside the plot area.<xref xlink:href="#fig.clipping_ex2"/> shows the result
                    after clipping has been enabled.</para>
                <para>
                    <informaltable frame="none">
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <tbody>
                                <row>
                                    <entry>
                                        <para>
                                            <programlisting>#=clipping_ex1|Original plot without clipping#</programlisting>
                                        </para>
                                    </entry>
                                    <entry>
                                        <para>
                                            <programlisting>#=clipping_ex2|Plot with clipping enabled#</programlisting>
                                        </para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </para>
                <para>
                    <note>
                        <para>By default clipping is disabled since it will slightly increase the
                            CPU load and the time to generate the graphs.</para>
                    </note>
                </para>
            </sect2>
        </sect1>
        <sect1 xml:id="sec1.adjusting-legend-position">
            <title>Adjusting the position and layout of the legend</title>
            <para>While it is not strictly necessary to use a legend in the graph ti describe the
                various data series potted it is usually a good idea. With the library there are
                three basic types of formatting you can do with the legend.</para>
            <para>
                <orderedlist>
                    <listitem>
                        <para>Adjusting basic parameters such as color and width of the edges
                            (frame) around the plot box as well as adding/removing a drop shadow on
                            the legend box.</para>
                    </listitem>
                    <listitem>
                        <para>Adjusting the position of the legend in the graph</para>
                    </listitem>
                    <listitem>
                        <para>Adjusting the number of columns that should be used for the internal
                            layout in the legend box. As default the legend uses one column.</para>
                    </listitem>
                </orderedlist>
            </para>
            <para>In <xref xlink:href="#fig.legend-position-examples"/> we have shown some ides on
                how the legend can be positioned in the graph to give some ideas on the options
                available.</para>
            <para>
                <figure xml:id="fig.legend-position-examples">
                    <title>Some example of ways to position the legend box in the graph</title>
                    <informaltable frame="all">
                        <tgroup cols="3">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <colspec colname="c3" colnum="3"/>
                            <tbody>
                                <row>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend1.png"
                                            /></imageobject></inlinemediaobject></entry>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend2.png"
                                            /></imageobject></inlinemediaobject></entry>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend3.png"
                                            /></imageobject></inlinemediaobject></entry>
                                </row>
                                <row>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend4.png"
                                            /></imageobject></inlinemediaobject></entry>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend5.png"
                                            /></imageobject></inlinemediaobject></entry>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend6.png"
                                            /></imageobject></inlinemediaobject></entry>
                                </row>
                                <row>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend7.png"
                                            /></imageobject></inlinemediaobject></entry>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend8.png"
                                            /></imageobject></inlinemediaobject></entry>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend9.png"
                                            /></imageobject></inlinemediaobject></entry>
                                </row>
                                <row>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend10.png"
                                                /></imageobject></inlinemediaobject></entry>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend15.png"
                                                /></imageobject></inlinemediaobject></entry>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend35.png"
                                                /></imageobject></inlinemediaobject></entry>
                                </row>
                                <row>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend55.png"
                                                /></imageobject></inlinemediaobject></entry>
                                    <entry><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/img_mmlegend75.png"
                                                /></imageobject></inlinemediaobject></entry>
                                    <entry>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </figure>
            </para>
            <para>The way the legend is positioned is by calling one of the two methods </para>
            <para><itemizedlist>
                    <listitem>
                        <para><code>Legend::SetPos($aX,$aY,$aHAlign='right',$aVAlign='top')</code></para>
                    </listitem>
                    <listitem>
                        <para><code>Legend::SetAbsPos($aX,$aY,$aHAlign='right',$aVAlign='top')</code></para>
                    </listitem>
                </itemizedlist>The first method specifies the position in fraction of the width and
                height and the second method specifies the position in absolute pixels where (0,0)
                is the top left corner. The anchor point for the legend box, i.e. the point in the
                legend box that should be aligned with the specified positoin, is given with the
                following two parameters. The line below gives an example of specifying the legend
                position </para>
            <para>
                <programlisting>$graph->legend->SetPos(0.5,0.98,'center','bottom');</programlisting>
            </para>
            <para>The line above will position the legend centered horizontally and the bottom of
                the legend just above the the bottom edge of the graph.</para>
            <para>
                <tip>
                    <para>The legend box can also have a drop shadow. By specifying the color to be
                        alpha-blended it is possible create a very nice drop shadow affect onto the
                        graph. See <xref xlink:href="#fig.filledgridex1"/> or <xref
                            xlink:href="#fig.legend-layouts"/> for some examples on how this
                        looks.</para>
                </tip>
            </para>
            <para>
                <tip>
                    <para>By default the ordering of the texts in te legend will be the same as the
                        order the plots are added to the graph. It is also possible to reverse this
                        order in the legend with a call to the method
                        <code>Legend::Revers()</code></para>
                </tip>
            </para>
            <para>The layout of the legend box can also be adjusted by specifying how many columns
                the legends should use. By default one column is used which means that all legend
                texts will be on top of each other. The number of columns to be used in the legend
                is specified with a call to the method</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para><code>Legend::SetColumns($aNbr)</code></para>
                    </listitem>
                </itemizedlist>
            </para>
            <para><xref xlink:href="#fig.legend-layouts"/> shows four examples how setting different
                values for the number of columns will change the layout of the legend.</para>
            <figure xml:id="fig.legend-layouts">
                <title>Some example of different legend layouts</title>
                <mediaobject>
                    <imageobject><imagedata fileref="images/legend-col-layouts.png" scale="70"
                        /></imageobject>
                </mediaobject>
            </figure>
            <para>As two special cases the one column layout (a.k.a. vertical layout) which is the
                default, and the "unlimited number of columns" a.k.a. horizontal layout can also be
                specified with the method</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para><code>Legend::SetLayout($aLayout)</code></para>
                        <para><code>$aLayout</code> is either <code>LEGEND_VERT</code> or
                                <code>LEGEND_HOR</code></para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <caution>
                    <para>Either <code>SetLayout()</code> or <code>SetColumns()</code> should be
                        used but not both since the method last called will be the one that is
                        used.</para>
                </caution>
            </para>
            <para>
                <tip>
                    <para>The vertical margin between two legend texts can be adjusted with a call
                        to the method</para>
                    <para>
                        <itemizedlist>
                            <listitem>
                                <para><code>Legend::SetVColMargin($aSpacing)</code></para>
                            </listitem>
                        </itemizedlist>
                    </para>
                    <para>by default the margin is quite small. <emphasis role="bold"
                            >Note</emphasis>. Since the bounding box for TTF fonts and bitmapped
                        texts are slightly different the distance between legend texts when using a
                        bitmap font (the default) will be visually larger than for TTF fonts. The
                        default value is optimized for TTF fonts.</para>
                </tip>
            </para>
        </sect1>
        <sect1>
            <title>Other formatting options of the axis</title>
            <sect2>
                <title>Adjusting and positioning titles on the axis</title>
                <para>Each title of the graph can have a title of there own. By default the x-axis
                    has the title on the right and the y-axis have the title in vertical at the top
                    of the graph. The title of the axis is accessed by the title property of the
                    axis for the x- and y-axis as in</para>
                <para><code>Graph::xaxis::title</code></para>
                <para><code>Graph::yaxis::title</code></para>
                <para>As a continence the following there methods are provided </para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::SetTitle($aTitle,$aAdjustAlign)</code></para>
                            <para>This method sets the title text string and the alignnemt of the
                                title. For the x-axis the alignment is pecified as one of the
                                folliwng three strings</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>"left"</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>"center"</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>"right"</code></para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                            <para>For an y-axis the alignment is set with one of the following three
                                strings</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>"bottom"</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>"middle"</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>"top"</code></para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::SetTitleMargin($aMargin)</code></para>
                            <para>The margin is specifies as the number of pixels distance from the
                                axis to the title</para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::SetTitleSide($aSideOfAxis)</code></para>
                            <para>The side specifies for a horizontal axis (x-axis) if the title
                                should be above or below the axis and for a vertical axis (y-axis)
                                if the title should be on the left or the right of the axis.</para>
                            <para>Y-axis defines:</para>
                            <para>
                                <orderedlist>
                                    <listitem>
                                        <para><code>SIDE_LEFT</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>SIDE_RIGHT</code></para>
                                    </listitem>
                                </orderedlist>
                            </para>
                            <para>X-axis defines</para>
                            <para>
                                <orderedlist>
                                    <listitem>
                                        <para><code>SIDE_TOP</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>SIDE_BOTTOM</code></para>
                                    </listitem>
                                </orderedlist>
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>
            </sect2>
            <sect2>
                <title>Adjusting the font and color of the title</title>
                <para>Since the title property can be easily accessed all usual Text class property
                    can be used. This includes the color property. To set the font and color of the
                    title for the x-axis the following methods are used</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Graph::xaxis::title::SetFont()</code></para>
                        </listitem>
                        <listitem>
                            <para><code>Graph::xaxis::title::SetColor()</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>For the y- and y2-axis the fonts and colors are set completely
                    analogues.</para>
            </sect2>
        </sect1>
        <sect1 xml:id="sec1.multiple-yaxis">
            <title>Using multiple y-axis</title>
            <para>With this feature an arbitrary number of Y-axis can be added to the right side of
                the graph. The library itself doesn't impose any restrictions on the number of extra
                Y-axis but from a practical concern it is most likely very difficult to interpret a
                graph with more than 2-3 extra y-axis. </para>
            <para>If there is only need for one more Y axis then the concept of the additional Y2
                axis is available as a convenient shortcut for this the most common use of an extra
                y-axis. The Y2 axis is also a first class citizen in the library meaning it has all
                the properties available to the "normal" Y-axis. </para>
            <para>These extra axis inherits most of the properties of the normal Y-axis (but not
                all) and the few restrictions imposed are described in <xref
                    xlink:href="#sec2.mulyaxis-restriction"/> below. </para>
            <para><xref xlink:href="#fig.mulyaxisex1"/> shows a basic example of how to use this
                feature. The color encoding maps a specific line to the corresponding axis.</para>
            <para>
                <programlisting>#=mulyaxisex1|Basic example of multiple y-axis#</programlisting>
            </para>
            <sect2>
                <title>Adding additional y-axis</title>
                <para>Adding additional Y-axis is very similar to the way standard Y axis work. The
                    Y-axis are numbered [0..n] where the 0:th axis is the Y-axis furthest to the
                    left. At the same time as these additional Y-axis are used it is also possible
                    to add a Y2 axis. The difference being that the Y2 axis can have all the same
                    options as the Y axis. </para>
                <para>For basic usage only three new methods are needed </para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para><code>Graph::SetYScale($aNbr,$aScaleType,$aMin,$aMax)</code>
                            </para>
                            <para>Specifies the type of scale ('lin', 'int' or 'log') to use for the
                                axis number '<code>$aNbr'</code>
                            </para>
                        </listitem>
                        <listitem>
                            <para><code>Graph::AddY($aNbr,$aPlot) </code></para>
                            <para>Add a plot to axis number <code>'$aNbr' </code></para>
                        </listitem>
                        <listitem>
                            <para><code>Graph::SetYDeltaDist($aDistance) </code></para>
                            <para>This is an optional method that if used specifies the default
                                number of pixels between each additional Y-axis. This value will be
                                used unless a specific position for the N:th axis has been
                                specified. By default the additional Y-axis are separated with 50
                                pixels (which is what is used in <xref xlink:href="#fig.mulyaxisex1"
                                />
                            </para>
                        </listitem>
                    </orderedlist>
                </para>
                <para>In order to initialize the extra y-axis the method SetYScale() must be called.
                    In <xref xlink:href="#fig.mulyaxisex1"/> the following lines are used</para>
                <para>
                    <programlisting>$graph->SetYScale(0,'lin');
$graph->SetYScale(1,'lin');
$graph->SetYScale(2,'lin');</programlisting>
                </para>
                <para>Once setup these additional Y-axis are accessed through the array </para>
                <para><code>Graph::ynaxis[] </code></para>
                <para>The axis are numbered from 0. By accessing the axis through this array most of
                    the same method as for the usual Y and Y2 axis are available. For example, the
                    line below will set the color of axis number 1 </para>
                <para>
                    <programlisting>$graph->ynaxis[1]->SetColor('red');</programlisting>
                </para>
                <para>Finally the plots are added to a specific axis with a call to the method
                        <code>AddY()</code> (as opposed to the regular <code>Add()</code> or
                        <code>AddY2()</code> methods). The first argument must be an ordinal that
                    specified the number of the axis that the plot should be added to.</para>
            </sect2>
            <sect2>
                <title>Using CSIM together with multiple y-axis</title>
                <para>Client Side Image Maps is fully supported and is used in the same way as CSIM
                    for the basic Y-axis. A short example will clarify this. The following code
                    snippet shows a line plot where we have added some oversized markers (in the
                    shape of diamonds) that will act as the image map areas for each data
                    series</para>
                <para>
                    <programlisting>&lt;?php
...
$lp2 = new LinePlot($datay2);
$lp2->mark->SetType(MARK_DIAMOND);
$lp2->mark->SetWidth(15);
$lp2->SetCSIMTargets($targ2,$alts2);
$graph->AddY(0,$lp2);
...
?></programlisting>
                </para>
                <para>As usual the targets for the image maps are specified with a call to
                        <code>Plot::SetCSIMTargets()</code>. An example of CSIM with multiple y-axis
                    is included in the Example directory and the resulting image is reproduced in
                        <xref xlink:href="#fig.mulyaxis_csim_static"/> (but just as an image not as
                    a CSIM image)</para>
                <para>
                    <figure xml:id="fig.mulyaxis_csim_static">
                        <title>Illustration of <uri
                                xlink:href="example_src/mulycsim_example_static.html"
                                >mulyaxiscsimex1.php</uri></title>
                        <mediaobject>
                            <imageobject><imagedata fileref="images/mulycsim_example_static.png"
                                    scale="70"/></imageobject>
                        </mediaobject>
                    </figure>
                </para>
            </sect2>
            <sect2 xml:id="sec2.mulyaxis-restriction">
                <title>Restrictions with multiple y-axis</title>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>Only standard plots can be added to the extra Y-axis, this means
                                no Text objects, no PlotBand, no PlotLines, no Icons etc </para>
                        </listitem>
                        <listitem>
                            <para>No Grid lines can not be added to the extra Y-axis </para>
                        </listitem>
                    </itemizedlist>
                </para>
            </sect2>
        </sect1>
        <sect1>
            <title>Understanding and using different scales on the axis</title>
            <sect2>
                <title>Different scale types</title>
                <para>The scale of the graph axis are controlled by either</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Graph::SetScale()</code> which can take on of the following
                                strings as argument</para>
                            <para>"intint", "intlin", "intlog", "linint", "linlin", "linlog",
                                "logint", "loglin", "loglog", "textint", "textlin", "textlog",
                                "datint","datlin","datlog"</para>
                            <para>The first half of the string argument specifies the x-axis scale
                                and the second half of the string specifies the y-axis scale. When
                                an y2 or multiple y-scales (see ?? </para>
                        </listitem>
                    </itemizedlist>
                </para>
                <sect3>
                    <title>Numerical scale types</title>
                    <para>The scale for a basic graph is specified with a call to
                            <code>Graph::SetScale()</code> and supplying the wanted scales for the
                        x- and y-axis. For numeric data there are three basic scales
                        available</para>
                    <para>
                        <orderedlist>
                            <listitem>
                                <para>Integer scale "int"</para>
                            </listitem>
                            <listitem>
                                <para>Linear scale (a.k.a decimal labels)</para>
                            </listitem>
                            <listitem>
                                <para>Logarithmic scales </para>
                            </listitem>
                        </orderedlist>
                    </para>
                    <para>The choice of scale will affect how the autoscaling is done and how the
                        labels will look. Choosing an integer scale will, as the name suggests,
                        restrict the labels to integer and integer interval between the scale step
                        (at each tick mark). The linear scale has no such restriction and can be
                        considered a superset of the integer scale (even though the implementation
                        is done in rather the opposite way). Labels for linear scale can have
                        fraction intervals and will shows the decimal values by default in the
                        labels. Finally the logarithmic scale will create a deca - logarithmic
                        scale.</para>
                    <para>The style of the labels can be formatted in two ways</para>
                    <para>
                        <orderedlist>
                            <listitem>
                                <para>By specifying a format string (in <code>printf()</code>
                                    format) to be used by calling the method
                                        <code>Axis::SetLabelFormatString()</code> The format string
                                    is interpretated according to the second parameter. If that
                                    parameter is "<code>true</code>" then the format string will be
                                    assumed to give a date format as expected by the
                                        <code>date()</code> function. This is an easy way to
                                    translate timestamp values to proper time/date labels.</para>
                            </listitem>
                            <listitem>
                                <para>By specifying a callback function. The callback
                                    function/method will be called with the label as the only
                                    argument and must return the label that should be printed
                                        <code>Axis::SetLabelFormatCallback()</code></para>
                                <para>For example. An easy way to get 1000' separators for numbers
                                    is to add the PHP function number_format() as callback to the
                                    wanted y-axis as in</para>
                                <para>
                                    <programlisting>$graph->yaxis->SetLabelFormatCallback('number_format');</programlisting>
                                </para>
                                <para>Another example of using a callback function is to "revert"
                                    the y-axis. By default the y-axis grows from the bottom and up.
                                    But what if we want the y-axis to grow from top to bottom, i.e.
                                    the 0-value should be at the top and the largest value at the
                                    bottom?</para>
                                <para>The way to accomplish this is to use a negative y-scale which
                                    the plot is made against (by negating all the data values in the
                                    data serie). This would then give the appearance that we want
                                    apart from the act that all labels will have a minus sign in
                                    front of them. By creating a callback function that just returns
                                    the absolute value of the label we can adjust that and we get
                                    the effect that we want. <xref xlink:href="#fig.inyaxisex2"/>
                                    shows an example of a "dive-curve" where the sea-level is at the
                                    top of the graph to give better connection to this particular
                                    use-case.</para>
                                <para>
                                    <programlisting>#=inyaxisex2|Inverted y-scale to show a dive profile#</programlisting>
                                </para>
                                <para>
                                    <note>
                                        <para>The dive profile in <xref xlink:href="#fig.inyaxisex2"
                                            /> is an actual dive of one of the authors dives in the
                                                <emphasis role="italic">Gulf of
                                            Bothnia</emphasis></para>
                                    </note>
                                </para>
                            </listitem>
                        </orderedlist>
                    </para>
                </sect3>
                <sect3>
                    <title>Textual scale types</title>
                    <para>There is only one pure textual scale type</para>
                    <para>
                        <orderedlist>
                            <listitem>
                                <para>Text scale ("text")</para>
                            </listitem>
                        </orderedlist>
                    </para>
                    <para>This type of scale is exclusively used for the x-axis.</para>
                    <para>The primary use of this scale is to label bars in a bar graph. However, as
                        will be shown this can also be used at other occasions to achieve various
                        wanted effects. There is no concept of autoscaling for text scales. Instead
                        the whole purpose of this type of scale is for the user to manually supply
                        the wanted labels in an array using the method
                            <code>Axis::SetTickLabels()</code>.</para>
                    <para>The other key difference for a text scale as compared to the numeric
                        scales is that the labels are positioned in between the tick marks and not
                        directly under them. This is the common practice to label bar graphs and
                        hence this is the way text scale works.</para>
                </sect3>
                <sect3>
                    <title>Date scale types</title>
                    <para>This scale type only has one valid scale</para>
                    <para>
                        <orderedlist>
                            <listitem>
                                <para>Date scale ("dat")</para>
                            </listitem>
                        </orderedlist>
                    </para>
                    <para>This specific scale type will assume that the data values are timestamps
                        and will properly format them to give "even" steps (in a time/date
                        sense).</para>
                </sect3>
            </sect2>
            <sect2>
                <title>Manual vs automatic scale handling</title>
                <para>Normally the scale is determined automatically in the library by analyzing the
                    input data and making sure that a suitable scale is established that fulfill the
                    following criteria:</para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para>The full dynamic scope of the data series can be displayed</para>
                        </listitem>
                        <listitem>
                            <para>The step size between major tick marks (tick marks that have a
                                label) is a multiple of either (1, 2, 5, 10 ) * 10 ^n, where the
                                size of 'n' is determined by the dynamic range of the data.</para>
                        </listitem>
                        <listitem>
                            <para>In addition the number of labels is dependent on the size of the
                                graph. A smaller graph will have fewer labels since there is
                                "physically" not enough room to show too many labels.</para>
                        </listitem>
                    </orderedlist>
                </para>
                <para>
                    <note>
                        <para>Internally the auto scaling algorithm has fair amount of intelligence
                            to try to make the scale in the same way a human would so ti. For
                            example the origin has a specially strong attraction meaning that the
                            autoscaling will try hard to make sure 0 is included in the scale as
                            long as it "makes sense".</para>
                    </note>
                </para>
                <para>Usually this works fine in most cases but there are always exception where
                    exact control over the scale is wanted. For example to be able to compare
                    several graphs that might otherwise get different scales. There are two ways of
                    manually adjusting the scales.</para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para><emphasis role="bold">Manual min/max values but with the tick
                                    marks automatically determined</emphasis></para>
                            <para>In this case the exact min/max value of the scale is submitted to
                                the SetScale() method call to set either (or both) of the x- and
                                y-scale. Since the first two argument after the scale type
                                determines the y min/max and the fourth and fifth argument specifies
                                the x min/max this means that in order to specify the x scale the y
                                scale must have some values. If the y axis should be left alone
                                (i.e. to be autoscaled) then just put the "dummy" values (0,0) as
                                placeholder in the method call. The following examples clarifies
                                this.</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>$graph->SetScale('intlin',0,0,-10,20);</code></para>
                                        <para>Y-scale is autoscaled and the x-scale is set to
                                            [-10,20]</para>
                                    </listitem>
                                    <listitem>
                                        <para><code>$graph->SetScale('intlin',0,50);</code></para>
                                        <para>Automatic x-scale and manual y-scale with range
                                            [0,50]</para>
                                    </listitem>
                                    <listitem>
                                        <para><code>$graph->SetScale('intlin','-10,10,-20,20);</code></para>
                                        <para>Manual x- and y-scale</para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold">Semi automatic (or semi
                                manual)</emphasis></para>
                            <para>This is a away to lock either the min or max value and let the
                                auto scaling algorithm determine a suitable corresponding max and
                                min value. This can be very useful to make sure that for example the
                                0 value is always includeded even if the minimal value is so high
                                that the autoscaling algorithm have chosen to start at a larger
                                value. These two locked down values are set with the two
                                methods</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>Scale::SetAutoMin()</code></para>
                                        <para>Example:
                                                <code>$graph->yaxis->scale->SetAutoMin(0);</code>
                                            This will lock the y-min to 0</para>
                                    </listitem>
                                    <listitem>
                                        <para><code>Scale::SetAutoMax()</code></para>
                                        <para>Example:
                                                <code>$graph->xaxis->scale->SetAutoMax(1000);</code>
                                            This will lock the x.max to 0</para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                    </orderedlist>
                </para>
            </sect2>
            <sect2>
                <title>Major and minor ticks</title>
                <para>The final step in understanding the scaling is to understand tick marks. There
                    are two types of tick marks, major and minor. Major tick marks are tick marks
                    that have a label associated. Up to now we have assumed that the library adjusts
                    where the tick marks are positioned and the inter spacing between tick marks. </para>
                <para>The tick object is available as an instance variable of the scale class which
                    means that you can access and adjust the tick mark properties by
                    accessing:</para>
                <para><code>$Graph::Axis::Scale::ticks</code></para>
                <para>For further fine control of the scale it is possible to manually adjust the
                    major and minor ticks using one of the three methods</para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para><emphasis role="bold">Adjusting how dense the auto scaling
                                    algorithm should put the tick marks.</emphasis></para>
                            <para>Even when using a fully automatic scaling it is possible to adjust
                                how many tick marks that the algorithm should try to place on the
                                scale. This is controlled with the method </para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>Graph::SetTickDensity($aYDensity,
                                                $aXDensity)</code></para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                            <para>The y- and x-scale density can be set to one of the following
                                (symbolic) values</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>TICKD_DENSE</code>k</para>
                                    </listitem>
                                    <listitem>
                                        <para><code>TICKD_NORMAL</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>TICKD_SPARSE</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>TICKD_VERYSPARSE</code></para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                            <para>By default the density for all scales are set to
                                    <code>TICKD_NORMAL</code>
                            </para>
                            <para>As a comparison <xref xlink:href="#fig.manscaleex2"/> is the exact
                                same as <xref xlink:href="#fig.manscaleex3"/> with the difference
                                that in this figure the density for the y-scale has been set to
                                    <code>TICKD_DENSE</code></para>
                            <para>
                                <programlisting>#=manscaleex3|Setting tick density to TICKD_DENSE#</programlisting>
                            </para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold">Manually specifying the step size between
                                    each minor and major tick.</emphasis></para>
                            <para>This is done using the method</para>
                            <para><code>LinearTicks::Set($aMajStep,$aMinStep=false)</code></para>
                            <para>please note that this is a method of the Tick class which is
                                available as an instance variable in the scale class</para>
                            <para>Example:
                                <code>$graph->xaxis->scale->ticks->Set(20,5);</code></para>
                            <para>This type of manual positioning of the tick marks might be useful
                                if the scale has been set to some non-multiples of 1,2,5,10. The
                                following examples will clarify this. In ?? the left graph is what
                                we get after manually specifying the y min/max values to (3,35). In
                                this case the auto scaling algorithm fails to assign "nice" steps to
                                the y-axis so that the tick marks starts and begins at the min/max
                                of the scale. If we manually set the tick distance to be (8,2), i.e.
                                we set the major tick marks 8 units apart and the minor
                                (non-labeled) tick marks 2 steps apart we get the much nicer result
                                as shown in the right graph in ??</para>
                            <para>
                                <informaltable frame="none">
                                    <tgroup cols="2">
                                        <colspec colname="c1" colnum="1"/>
                                        <colspec colname="c2" colnum="2"/>
                                        <tbody>
                                            <row>
                                                <entry>
                                                  <para>
                                                  <programlisting>#=manscaleex2|Fully automatic not so good scaling#</programlisting>
                                                  </para>
                                                </entry>
                                                <entry>
                                                  <para>
                                                  <programlisting>#=manscaleex1|Manually specified tick distance which gives a much better appearance#</programlisting>
                                                  </para>
                                                </entry>
                                            </row>
                                        </tbody>
                                    </tgroup>
                                </informaltable>
                            </para>
                            <para>
                                <caution>
                                    <para>The major tick step must be an even multiple of the minor
                                        tick step. If this is not the case the library will
                                        automatically adjust the major step size to be the closest
                                        multiple of the minor step size.</para>
                                </caution>
                            </para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold">Specify the exact position for each single
                                    tick mark</emphasis></para>
                            <para>This is often used to position only the major tick marks to be
                                able to have labels at very specific points in the graph. One
                                example of how to use this was shown in <xref
                                    xlink:href="#fig.manualtickex2"/> where the tick marks were
                                positioned at factions of . Another typical example is to place a
                                label at exactly the beginning of a month. Since months have
                                different lengths there is no other way if 100% precision is wanted.
                                An example of this is shown in <xref xlink:href="#fig.manualtickex1"
                                />
                            </para>
                            <para>
                                <programlisting>#=manualtickex1|Manually specifying the tick position for each month#</programlisting>
                            </para>
                            <para>
                                <caution>
                                    <para>When the tick position is manually set there should also
                                        be a corresponding array of labels to be put at these
                                        positions.</para>
                                </caution>
                            </para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold">Adjusting the size and on what side the tick
                                    marks should be drawn</emphasis></para>
                            <para>The side on the axis which has the tick marks is adjusted with a
                                call to</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para>Axis::SetTickSide($aTickSide)</para>
                                        <para>Possible options for the tick side are</para>
                                        <para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>SIDE_UP</para>
                                                </listitem>
                                                <listitem>
                                                  <para>SIDE_DOWN</para>
                                                </listitem>
                                                <listitem>
                                                  <para>SIDE_LEFT</para>
                                                </listitem>
                                                <listitem>
                                                  <para>SIDE_RIGHT</para>
                                                </listitem>
                                            </itemizedlist>
                                        </para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                            <para>For example, the following lines added to a script would change
                                side of the labels and tick marks for the x-axis.</para>
                            <para>
                                <programlisting>&lt;?php
$graph->xaxis->SetLabelPos( SIDE_UP );
$graph->xaxis->SetTickSide( SIDE_DOWN ); 
?></programlisting>
                            </para>
                            <para>This technique can for example be used to put the x-axis at the
                                top of the graph as the following example shows.</para>
                            <para>
                                <programlisting>#=topxaxisex1|Adjusting the side which have the tick marks and position the x-axis at the top#</programlisting>
                            </para>
                        </listitem>
                    </orderedlist>
                </para>
                <para>In passing we mention that there are additional ways to adjust the look and
                    feel of the tick marks which is discussed in the next section (<xref
                        xlink:href="#sec1.adv-scale-label-handling"/>) in detail.</para>
            </sect2>
        </sect1>
        <sect1 xml:id="sec1.adv-scale-label-handling">
            <title>Adjusting the appearance of the scale labels</title>
            <para>Since scale labels play such an important part of producing a visually pleasing
                graph there are a number of ways to fine tune this appearance. In the section below
                we have tried to logically group the different options to make it easier to get an
                overview.</para>
            <para/>
            <sect2>
                <title>Adjusting the position</title>
                <para>The exact position of the labels can be adjusted with the methods</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::SetLabelAlign($aHAlign,$aVAlign='top',$aParagraphAlign='left')</code></para>
                            <para>With this method the anchor point for the labels can be adjusted.
                                The labels are positioned straight below (or on the side for
                                vertical axis) the corresponding tick mark and by adjusting the
                                anchor point in the label different effect can be achieved. By
                                default labels on the x-axis there anchor point on the top side in
                                the center. For y-axis (on the left) the anchor point is middle of
                                the right edge of the label.</para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::SetLabelMargin($aMargin)</code></para>
                            <para>This method adjusts the distance between the corresponding tick
                                mark and the label it self.</para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::SetLabelSide($aSidePos)</code></para>
                            <para>This method will adjust on what side the labels will be
                                positioned. For a horizontal axis it cna be either above or below
                                the axis and for a vertical axis it can be on the left or right
                                side. The position is defined by one of the following
                                self-explaining defines</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>SIDE_LEFT</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>SIDE_RIGHT</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>SIDE_TOP</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>SIDE_BOTTOM</code></para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>
            </sect2>
            <sect2>
                <title>Adjusting font and color</title>
                <para>By default the color of the labels will be the same as for the axis but it is
                    possible to use a different color for the labels by supplying a second argument
                    to the <code>SetColor()</code> method for the axis.</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::SetColor($aColor,$aLabelColor=false) </code></para>
                            <para>There is actually a special twist to the color specification here.
                                If the color is specified as a single value this color value will be
                                used for all labels. However, if the color is specified with an
                                array then those colors will be used for the labels in turn. If
                                there are more labels then colors specified then the colors will be
                                used in a wrap around fashion.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>The font family for the labels can be specified with</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::SetFont($aFamily,$aStyle=FS_NORMAL,$aSize=10)</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>By default a bitmap font is used for the labels (since those are the only
                    fonts guaranteed to be available everywhere)</para>
                <para>
                    <example>
                        <title>Adjusting the axis font and color</title>
                        <programlisting>$graph->xaxis->SetFont(FF_ARIAL,FS_NORMAL,9);
$graph->xaxis->SetColor('black','blue');</programlisting>
                    </example>
                </para>
            </sect2>
            <sect2>
                <title>Adjusting the background of the labels</title>
                <para>As a kind of a very special formatting it is also possible to set a specific
                    background for just the labels on the graph. This is most often used when there
                    is background image that risks of hiding the clarity of the labels. In those
                    cases it can be suitable to have a some lighter background to make it easier to
                    read the labels. </para>
                <para>
                    <tip>
                        <para>This feature can also come in handy when using the more advanced
                            feature of combining several graphs to amke the labels stand out.</para>
                    </tip>
                </para>
                <para>The method that controls this is</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>SetAxisLabelBackground($aType,$aXFColor='lightgray',$aXColor='black',$aYFColor='lightgray',$aYColor='black')</code></para>
                            <para>Possible values of the type of background are:</para>
                            <para>
                                <orderedlist>
                                    <listitem>
                                        <para><code>LABELBKG_NONE</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>LABELBKG_XAXIS</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>LABELBKG_YAXIS</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>LABELBKG_XAXISFULL</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>LABELBKG_YAXISFULL</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>LABELBKG_XY</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>LABELBKG_XYFULL</code></para>
                                    </listitem>
                                </orderedlist>
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>The way these possible background types works is best described by viewing the
                    example figures below</para>
                <para>
                    <informaltable frame="none">
                        <tgroup cols="3">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <colspec colname="c3" colnum="3"/>
                            <tbody>
                                <row>
                                    <entry>
                                        <para>
                                            <programlisting>#=axislabelbkgex01|<code>LABELBKG_NONE</code>#</programlisting>
                                        </para>
                                    </entry>
                                    <entry>
                                        <para>
                                            <programlisting>#=axislabelbkgex02|LABELBKG_XAXIS#</programlisting>
                                        </para>
                                    </entry>
                                    <entry>
                                        <para>
                                            <programlisting>#=axislabelbkgex03|LABELBKG_YAXIS#</programlisting>
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>
                                            <programlisting>#=axislabelbkgex04|LABELBKG_YAXISFULL#</programlisting>
                                        </para>
                                    </entry>
                                    <entry>
                                        <para>
                                            <programlisting>#=axislabelbkgex05|LABELBKG_XAXISFULL#</programlisting>
                                        </para>
                                    </entry>
                                    <entry>
                                        <para>
                                            <programlisting>#=axislabelbkgex06|LABELBKG_XYFULL#</programlisting>
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>
                                            <programlisting>#=axislabelbkgex07|LABELBKG_XY#</programlisting>
                                        </para>
                                    </entry>
                                    <entry/>
                                    <entry/>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </para>
            </sect2>
            <sect2>
                <title>Hiding and rotating labels</title>
                <para>For the x-axis it is common to rotate the label to better fit long text
                    labels. This is done with a call to</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::SetLabelAngle($aAngle)</code></para>
                            <para>Remember that in order to set an arbitrary angel on the labels the
                                font family must be one of the TTF font families. Bitmap fonts only
                                support horizontal and vertical rotation.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>There are actually five variant for hiding the aaxis</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::HideLabels($aHide=true)</code></para>
                            <para>This will hide all the labels on the axis</para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::HideFirstLastLabels($aHide=true)</code></para>
                            <para>Will hide the first and last label</para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::HideFirstLabels($aHide=true)</code></para>
                            <para>Will hide the first label</para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::HideLastLabels($aHide=true)</code></para>
                            <para>Will hide the last label</para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::HideZeroLabel($aHide=true)</code></para>
                            <para>This will avoid printing a "0.00" label. This can be useful when
                                the axis are set to be crossing at the origin. This was for example
                                used in <xref xlink:href="#fig.funcex2"/></para>
                        </listitem>
                    </itemizedlist>
                </para>
            </sect2>
            <sect2>
                <title>Fine tuning the automatic scales</title>
                <para>By default the auto-scaling algorithm tries ot find as tight upper and lower
                    bands as possible as long as they are even multiple of the chosen major step
                    size. In some instances some more space is needed. For example to have extra
                    room at the top of the graph to show data labels. In order to have some extra
                    space the method </para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>LinearScale::SetGrace($aGraceTop,$aGraceBottom=0)</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>should be used. This method will adjust the autos calling algorithm by adding
                    the specified extra "grace"at the minimum and maximum value of the scale. The
                    grace value is specified as an integer [0,100] and specifies a percentage to add
                    to the min and max value before the auto scaling is made. Depending on the scale
                    step and overall scale several scale values might give the same resulting scale.
                    For example</para>
                <para>
                    <programlisting>$graph->yscale->scale->SetGrace(20,20);</programlisting>
                </para>
                <para>will add 20% extra values on the top and bottom values of the data series
                    before the auto scale is determined. The following four examples shows how this
                    can be used in practice. In <xref xlink:href="#fig.grace_ex0"/> a bar graph
                    without grace value is created. As can be seen since the scale is very tight the
                    labels of the individual bars are almost out of the graph plot area. In the
                    following three plots results of using different values for grace are
                    shown.</para>
                <para>
                    <informaltable frame="none">
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <tbody>
                                <row>
                                    <entry>
                                        <para>
                                            <programlisting>#=grace_ex0|The original graph#</programlisting>
                                        </para>
                                    </entry>
                                    <entry>
                                        <para>
                                            <programlisting>#=grace_ex1|Using a 10% grace#</programlisting>
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>
                                            <programlisting>#=grace_ex2|Using a 50% grace#</programlisting>
                                        </para>
                                    </entry>
                                    <entry>
                                        <para>
                                            <programlisting>#=grace_ex3|Using a 100% grace#</programlisting>
                                        </para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </para>
                <para>We finish this section by noting that adding a large grace value might
                    sometimes make it necessary to move one or both of the axis manually. To explain
                    this we start with the graph in <xref xlink:href="#fig.example3.2"/></para>
                <para>
                    <programlisting>#=example3.2|The original line graph#</programlisting>
                </para>
                <para>as can be seen the added plot marks (see ??) are outside the boundary of the
                    plot area and to solve this problem we add the line</para>
                <para>
                    <programlisting>$graph->yaxis->scale->SetGrace( 10 , 10 ); </programlisting>
                </para>
                <para>to the script. This now gives the result shown in <xref
                        xlink:href="#fig.example3.2.1"/></para>
                <para>
                    <programlisting>#=example3.2.1|Adding grace values. Note x-axis position at y=0#</programlisting>
                </para>
                <para>The problem is now apparent. Since the x-axis is placed at y=0 by default the
                    x-axis is no longer at the bottom of the plot as was probably the intention. To
                    remedy this situation we have to manually place the x-axis at the minimum
                    y-scale position. This is done by adding the line</para>
                <para>
                    <programlisting>$graph->xaxis->SetPos( 'min' ); </programlisting>
                </para>
                <para>to the previous script. Doing this gives us back the wanted position of the
                    x-axis as shown in <xref xlink:href="#fig.example3.2.2"/></para>
                <para>
                    <programlisting>#=example3.2.2|Adjusting the position of the x-axis manually#</programlisting>
                </para>
            </sect2>
            <sect2>
                <title>Manually altering the appearance of tick marks</title>
                <para>To adjust the appearance of the tick marks the following three methods can be
                    used</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::SetTickSide($aSide)</code></para>
                            <para>For x-axis this specifies if the tick should be drawn above or
                                below the axis and for the y-axis it specifies if the tick marks
                                should be on the left or on the right of the axis. Possible values
                                of the side parameter are one of the following defines</para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para><code>SIDE_LEFT</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>SIDE_RIGHT</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>SIDE_TOP</code></para>
                                    </listitem>
                                    <listitem>
                                        <para><code>SIDE_BOTTOM</code></para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::HideTicks($aHideMinor=true,$aHideMajor=true)</code></para>
                            <para>Calling this method will make it possible to hide either noe of or
                                both the minor or the major tick marks.</para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::SetTickSize($aMajSize,$aMinSize=3)</code></para>
                            <para>This specifies the size (in pixels) of the major and minor tick
                                marks.</para>
                        </listitem>
                    </itemizedlist>
                </para>
            </sect2>
            <sect2 xml:id="sec2.manually-spec-labels">
                <title>Manually specifying scale labels</title>
                <para>As was mentioned before it is perfectly possible to manually specify the scale
                    labels. This is normally done for "text" scales that are most commonly used with
                    bar graphs. </para>
                <para>Specifying a text scale for the axis (normally the x-axis) will "reserve" a
                    position for every data value that must be manually set. In some ways this is
                    the same as having a linear scale with major and minor step size set to 1. </para>
                <para>As a very basic example of a text scale with a bar graph <xref
                        xlink:href="#fig.manual_textscale_ex1"/> shows some fictive values for each
                    month of the year. In that example the scale has been set to a text scale and
                    each value has been specified as an array containing all the names of the
                    months.</para>
                <tip>
                    <para>An easy way to get hold of the names of the months is to use the library
                        global instance <code>$gDateLocale</code> of class <code>DateLocale</code>.
                        This class has several utility methods. For example the two methods</para>
                    <para>
                        <itemizedlist>
                            <listitem>
                                <para><code>GetShortMonthName($aNbr)</code></para>
                            </listitem>
                            <listitem>
                                <para><code>GetLongMonthName($aNbr)</code></para>
                            </listitem>
                        </itemizedlist>
                    </para>
                    <para>will return the proper month names (in either short or short or long
                        format) in the current locale. For more details see <xref
                            xlink:href="#fig.manual_textscale_ex1"/>
                    </para>
                </tip>
                <para>
                    <figure>
                        <title>Manual text scale example </title>
                        <programlisting>#=manual_textscale_ex1|Manual text scale with month labels#</programlisting>
                    </figure>
                </para>
                <para>Since the manual text scale sets a scale label for every single data point
                    this would give problem for the case where we have a large number of data points
                    where it is not possible to label every data point. In order to control this the
                    following two methods are used</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::SetTextTickInterval($aStep,$aStart=0)</code></para>
                            <para>This method controls the interval between the tick marks for a
                                text scale. Since by default every tick will have a label it also
                                specifies how dense the labels will be. The following examples
                                clarifies how this works</para>
                            <para>
                                <example>
                                    <title>Adjusting manual text tick interval </title>
                                    <programlisting>#=manual_textscale_ex2|Setting text tick interval=2#</programlisting>
                                </example>
                            </para>
                            <para>In the above example only ever second text tick mark is set and
                                since the labels are also placed at every tick marks only every
                                second label are shown. </para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::SetTextLabelInterval($aStep)</code></para>
                            <para>This method complements the previous method. This method
                                exclusively determines where the labels are place. This makes it
                                possible to have more tick marks than labels. The previous example
                                    <xref xlink:href="#fig.manual_textscale_ex2"/> look a bit
                                strange since there are no tick-marks between every second bar. A
                                better solution in this case would be to have tick marks between
                                each bar but only label every second tick mark. This is exactly what
                                can be done with this method. It specifies that every n:th tick mark
                                should have a label.</para>
                            <para>In <xref xlink:href="#fig.manual_textscale_ex3"/> we have used
                                this method instead.</para>
                            <para>
                                <example>
                                    <title>Adjusting the interval for the labels</title>
                                    <programlisting>#=manual_textscale_ex3|Labels at every 2:nd tick mark#</programlisting>
                                </example>
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>Finally we show an example where there is a need to combine the above two
                    methods to get a reasonable looking scale. This happens when there are so many
                    data points that it is not possible to show every tick marks. To show that text
                    scales can also be used with other plot types than bar we have chosen to show a
                    line graph where we show data that has 40 data points per month (480 data points
                    per year). Let us assume that in this application we want to have tick marks at
                    every 40 points (i.e. a total of 12 tick marks) and have labels only on every
                    2:th tick label (i.e. a total of 6 labels).</para>
                <para>
                    <caution>
                        <para>The label array must have labels for every tick mark even if they are
                            not shown. </para>
                    </caution>
                </para>
                <para>
                    <example>
                        <title>Adjusting both text tick mark and label interval</title>
                        <programlisting>#=manual_textscale_ex4|Tick marks every 40 points and labels every 2:nd tick mark#</programlisting>
                    </example>
                </para>
                <para>In addition to the text scale is it in principle also possible to use a manual
                    scale with integer scale as shown in <xref xlink:href="#sec1.graphing-sun-spots"
                    /></para>
                <para>
                    <note>
                        <para>It is also perfectly legal to override the default labels for the Y
                            (and Y2) axis in the same way as we have shown for the x-axis but this
                            is probably a less used scenario. </para>
                    </note>
                </para>
                <para>
                    <caution>
                        <para>Please note that the supplied labels will be applied to each major
                            tick label. If there are insufficient number of supplied labels the
                            non-existent positions will have the ordinal number of the label.</para>
                    </caution>
                </para>
            </sect2>
            <sect2>
                <title>Emphasize of parts of the scale</title>
                <para>Sometimes it is a good idea to emphasize part of the scale. It can be on
                    either the x- or the y-axis. The library offers the possibility to add a band
                    with a separate background color for part of the scale in either x, y (or both)
                    directions.</para>
                <para>A plotband is defined as an instance of <code>class PlotBand</code> that is
                    added to the graph in the same way as normal plots. A plot band can have a
                    number of different styles to achieve the wanted affect and it can be placed
                    either on top or behind the plot.</para>
                <para>An instance is created and added to the graph as shown by the following
                    example</para>
                <para>
                    <programlisting>// Add a horizontal band
$band = new PlotBand(HORIZONTAL,BAND_RDIAG,15,35,'khaki4');
$band->ShowFrame(false); // No border around the plot band
$graph->Add($band);</programlisting>
                </para>
                <para>The code snippet above adds a horizontal band with a diagonal pattern (from
                    top left to bottom right). The horizontal band is shown between the y-scale
                    values [15,35]. </para>
                <para>The types of plotbands supported by the library is shown in the table
                    below</para>
                <para>
                    <example xml:id="ex.types-of-plotbands">
                        <title>Different densities for plot bands</title>
                        <informaltable frame="none">
                            <tgroup cols="3">
                                <colspec colname="c1" colnum="1"/>
                                <colspec colname="c2" colnum="2"/>
                                <colspec colname="c3" colnum="3"/>
                                <tbody>
                                    <row>
                                        <entry>
                                            <para>
                                                <programlisting>#=smallstaticbandsex1|BAND_RDIAG#</programlisting>
                                            </para>
                                        </entry>
                                        <entry>
                                            <para>
                                                <programlisting>#=smallstaticbandsex2|BAND_LDIAG#</programlisting>
                                            </para>
                                        </entry>
                                        <entry>
                                            <para>
                                                <programlisting>#=smallstaticbandsex10|BAND_DIAGCROSS#</programlisting>
                                            </para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>
                                                <programlisting>#=smallstaticbandsex7|BAND_HLINE#</programlisting>
                                            </para>
                                        </entry>
                                        <entry>
                                            <para>
                                                <programlisting>#=smallstaticbandsex6|BAND_VLINE#</programlisting>
                                            </para>
                                        </entry>
                                        <entry>
                                            <para>
                                                <programlisting>#=smallstaticbandsex5|BAND_HVCROSS#</programlisting>
                                            </para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para>
                                                <programlisting>#=smallstaticbandsex4|BAND_3DPLANE#</programlisting>
                                            </para>
                                        </entry>
                                        <entry>
                                            <para>
                                                <programlisting>#=smallstaticbandsex3|BAND_SOLID#</programlisting>
                                            </para>
                                        </entry>
                                        <entry>
                                            <para>
                                            </para>
                                        </entry>
                                    </row>
                                </tbody>
                            </tgroup>
                        </informaltable>
                    </example>
                </para>
                <para>For some of these patterns it is also possible to specify an additional
                    density parameter via the method <code>PlotBand::SetDensity()</code> that
                    specifies how dense the pattern should be. For example <xref
                        xlink:href="#ex.plotband-densities"/> shows three variants of the 3D plane
                    with different density parameters.</para>
                <para>
                    <example xml:id="ex.plotband-densities">
                        <title>Different densities for various plot bands</title>
                        <informaltable frame="none">
                            <tgroup cols="3">
                                <colspec colname="c1" colnum="1"/>
                                <colspec colname="c2" colnum="2"/>
                                <colspec colname="c3" colnum="3"/>
                                <tbody>
                                    <row>
                                        <entry>
                                            <para>
                                                <programlisting>#=plotbanddensity_ex0|SetDensity(10)#</programlisting>
                                            </para>
                                        </entry>
                                        <entry>
                                            <para>
                                                <programlisting>#=plotbanddensity_ex1|SetDensity(40)#</programlisting>
                                            </para>
                                        </entry>
                                        <entry>
                                            <para>
                                                <programlisting>#=plotbanddensity_ex2|SetDensity(80)#</programlisting>
                                            </para>
                                        </entry>
                                    </row>
                                </tbody>
                            </tgroup>
                        </informaltable>
                    </example>
                </para>
                <tip>
                    <para>3D planes actually carry another possible modification. You can specify
                        the vanish point to change the perspective used. You can't access the method
                        to change the horizon directly but you can access it through</para>
                    <para>
                        <programlisting> $band ->prect->SetHorizon( $aHorizon)</programlisting>
                    </para>
                    <para>assuming that the band is a 3D plane.</para>
                </tip>
                <para>To finish this section we show one slightly more creative use of background
                    plot bands in <xref xlink:href="#fig.staticbandbarex7"/></para>
                <para>
                    <figure>
                        <title>Creative use of plot bands</title>
                        <programlisting>#=staticbandbarex7|Creative use of plot bands#</programlisting>
                    </figure>
                </para>
            </sect2>
            <sect2>
                <title>Adding static lines for specific scale values in the graph</title>
                <para>In addition to the plot band it is possible to add static lines to emphasize a
                    specific scale value. A pot line is added to the graph by creating an instance
                    of the <code>class PlotLine</code> in much the same way as for plot bands. The
                    following code snippets show how this can be done</para>
                <para>
                    <programlisting>// Add mark graph with static lines
$line = new PlotLine(HORIZONTAL,10,"black",2);
$graph->AddLine($line);</programlisting>
                </para>
                <para>The above code snippets adds a black plot line (weight=2) at scale position
                    y=10.</para>
                <para>In addition to using this feature to show min/max values (or perhaps critical
                    limits) another usage can be to show a zero-line as the following example in
                        <xref xlink:href="#fig.impulsex4"/> shows.</para>
                <para>
                    <figure>
                        <title>Use of a static line to simulate an extra x-axis at y=0</title>
                        <programlisting>#=impulsex4|Adding a static line at y=0 to simulate an extra 0-axis#</programlisting>
                    </figure>
                </para>
            </sect2>
        </sect1>
        <sect1>
            <title>Using a logarithmic scale</title>
            <para>In all the previous discussion we have used linear scales. Another option is to
                use a logarithmic scale. This is often used when there is a need to display both
                very small and very large values in the same graph. The library supports the use of
                logarithmic scales on both the x- and y-axis (as well as the optional extra
                y-axis).</para>
            <para>The logarithmic scale support is defined in the module file
                    "j<filename>pgraph_log.php</filename>" so this must be included in order to
                access this feature.</para>
            <para>To illustrate the use of a logarithmic scale we will make a graph which uses two
                y-axis and make the second y-axis have a logarithmic scale (we will actually take
                the graph in <xref xlink:href="#fig.example6"/> and change the second y-axis to be a
                logarithmic scale instead).</para>
            <para>In order to use a logarithmic scale on the second (Y2) axis we only need to
                change</para>
            <para>
                <programlisting>$graph->SetY2Scale('lin');</programlisting>
            </para>
            <para>to</para>
            <para>
                <programlisting>$graph->SetY2Scale('log');</programlisting>
            </para>
            <para>and the library will take care of the rest. The result of this is shown in <xref
                    xlink:href="#fig.example7"/></para>
            <para>
                <programlisting>#=example7|Changing the Y2 scale from linear to logarithmic#</programlisting>
            </para>
            <para>By default only the major grid lines on the y-axis are shown. By adding the
                lines</para>
            <para>
                <programlisting>$graph->ygrid->Show(true,true);
$graph->xgrid->Show(true,false);</programlisting>
            </para>
            <para>We can enable both the x-grid lines as well as the minor grid lines on the y-axis
                to get the result shown in <xref xlink:href="#fig.example8"/> below</para>
            <para>
                <programlisting>#=example8|Enabling minor grid lines on the y-axis and also grid lines on the x-axis#</programlisting>
            </para>
            <para>In addition to using a logarithmic scale on the y-axis to generate what is
                commonly known as a "lin-log" scale it is also possible to use a logarithmic scale
                on the x-axis to get a "log-log" plot (as is often used in electrical engineering).
                An example of this is shown in <xref xlink:href="#fig.loglogex1"/></para>
            <para>
                <programlisting>#=loglogex1|An example of a log-log plot (where both the y- and x-axis use a logarithmic scale)#</programlisting>
            </para>
            <para>
                <note>
                    <para>The example in <xref xlink:href="#fig.loglogex1"/> also makes use of
                        scatter plots which we have not yet introduced but is a way to draw a plot
                        of a number of data points specified by both there x- and
                        y-coordinates.</para>
                </note>
            </para>
            <para>
                <tip>
                    <para>If you think the first value of the Y-axis is to close to the first label
                        of the X-axis you have the option of either increasing the margin (with a
                        call to <code>SetLabelMargin()</code> ) or to hide the first label (with a
                        call to <code>Axis::HideFirstTickLabel()</code> )</para>
                </tip>
            </para>
            <para>As a final example of using a logarithmic scale we show how to combine a text
                scale for the x-axis and a logarithmic scale for the y-axis. As we already shown in
                    <xref xlink:href="#sec1.graphing-sun-spots"/> it is possible to manually specify
                the labels that should be used on the axis with a call to Axis::SetTickLabels().
                Let's make use of this and the built-in library super global variable
                    "<code>$gDateLocale</code>" which is an instance of a date utility class to get
                a list of the name of all the months in a localized fashion.</para>
            <para>To use the name of the months on the x-axis we haev to add the following two lines
                to the previous example</para>
            <para>
                <programlisting>&lt;?php
$montnames = $gDateLocale->GetShortMonth();
$graph->xaxis->SetTickLabels( $montnames ); 
?></programlisting>
            </para>
            <para>The result of adding these two lines are shown in <xref xlink:href="#fig.example9"
                /> below</para>
            <para>
                <programlisting>#=example9|Using a text-log scale#</programlisting>
            </para>
            <para>Since the name of the months are quite close we can change what labels should be
                displayed as was discussed in <xref xlink:href="#sec2.manually-spec-labels"/> to
                only show every second label. Doing this change gives the result shown in <xref
                    xlink:href="#fig.example9.1"/></para>
            <para>
                <programlisting>#=example9.1|Adjusting the text scale so that only every second labels are displayed.#</programlisting>
            </para>
            <para>Another option if we think that the labels are too close is to rotate them. In
                    <xref xlink:href="#fig.example9.2"/> we have kept all labels but rotated them 90
                degree.</para>
            <para>
                <programlisting>#=example9.2|Rotating the x-axis labels 90 degree#</programlisting>
            </para>
            <para>
                <caution>
                    <para>Remember that the built-in bitmap fonts only supports 0 and 90 degree
                        text. TTF fonts support texts at an arbitrary angle.</para>
                </caution>
            </para>
        </sect1>
        <sect1>
            <title>Using a date/time scale</title>
            <para>The easiest way to get a date time scale for the X-axis is to use the pre-defined
                    "<code>dat</code>" scale. To be able to use that it is first necessary to
                include the module "<filename>jpgraph_date.php</filename>" and then specify the
                scale, for example as "<code>datlin</code>" in the call to
                    <code>Graph::SetScale()</code> as the following code snippet shows.</para>
            <para>
                <programlisting>&lt;?php
require_once( "jpgraph/jpgraph.php" );
require_once( "jpgraph/jpgraph_line.php" );
require_once( "jpgraph/jpgraph_date.php" );
...
$graph = new Graph ( ... );
$graph->SetScale( 'datlin' );
... 
?></programlisting>
            </para>
            <para>It is possible to use a selectable degree of automation when dealing with date
                scales. The easiest way is to let the library deal with all the details and make it
                own decision on how to format the scale. Unfortunately this might not always be
                exactly what was intended and hence it is also possible to give the library hints on
                how the formatting should be done or specify to a great details the exact formatting
                needed.</para>
            <para>Bot the y- and the x-axis can have a date scale but the most common case is to
                only use date scale on the x-axis.</para>
            <sect2>
                <title>Specifying the input data</title>
                <para>No matter how the formatting is done the input data is assumed to be a
                    timestamp value, i.e. the number of seconds since epoch (as defined on the local
                    system executing the graph). In PHP the current timestamp value is returned by
                    the function <code>time()</code>.</para>
                <para>This means that it is always mandatory to specify two input vectors for a
                    plot.One vector for the Y-data and one vector for the x-data. The following line
                    of code prepares a line plot for the use with a date scale</para>
                <para>
                    <programlisting>$lineplot = new LinePlot( $ydata , $xdata ); </programlisting>
                </para>
                <para>
                    <caution>
                        <para>Note the order of the data vectors. The Y-data always comes
                            first.</para>
                    </caution>
                </para>
                <para>A first example is shown in <xref xlink:href="#fig.dateaxisex2"/> where we
                    have created a number of random points with a sample interval of 240s (chosen
                    completely arbitrary)</para>
                <para>
                    <programlisting>#=dateaxisex2|A first date scale example#</programlisting>
                </para>
                <para>Please review the script that creates this graph before continuing since we
                    will base all further examples on this.</para>
            </sect2>
            <sect2>
                <title>Adjusting the start and end date alignment</title>
                <para>As can be seen from the example in <xref xlink:href="#fig.dateaxisex2"/> the
                    scale starts slightly before the first data point. </para>
                <para>Why? </para>
                <para>This is of course by purpose in order to make the first time label start on an
                    "even" value, in this case on an hour. Depending on the entire interval of the
                    graph the start value will dynamically adjust to match the chosen date/time
                    interval, this could for example be on an even minute, even 30min, even hour,
                    even day, even week and so on. It all depends on the scale.</para>
                <para>The alignment of the start (and end) date can also be adjusted manually by
                    using the two methods</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>DateScale::SetTimeAlign($aStartAlign,$aEndAlign)</code></para>
                            <para>The following symbolic constants can be used to define the time
                                alignment</para>
                            <para>
                                <orderedlist>
                                    <listitem>
                                        <para>Alignment on seconds</para>
                                        <para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>MINADJ_1, Align on a single second (This is
                                                  the lowest resolution)</para>
                                                </listitem>
                                                <listitem>
                                                  <para>MINADJ_5, Align on the nearest 5
                                                  seconds</para>
                                                </listitem>
                                                <listitem>
                                                  <para>MINADJ_10, Align on the nearest 10
                                                  seconds</para>
                                                </listitem>
                                                <listitem>
                                                  <para>MINADJ_15, Align on the nearest 15
                                                  seconds</para>
                                                </listitem>
                                                <listitem>
                                                  <para>MINADJ_30, Align on the nearest 30
                                                  seconds</para>
                                                </listitem>
                                            </itemizedlist>
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>Alignment on minutes</para>
                                        <para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>MINADJ_1, Align to the nearest minute</para>
                                                </listitem>
                                                <listitem>
                                                  <para>MINADJ_5, Align on the nearest 5
                                                  minutes</para>
                                                </listitem>
                                                <listitem>
                                                  <para>MINADJ_10, Align on the nearest 10
                                                  minutes</para>
                                                </listitem>
                                                <listitem>
                                                  <para>MINADJ_15, Align on the nearest 15
                                                  minutes</para>
                                                </listitem>
                                                <listitem>
                                                  <para>MINADJ_30, Align on the nearest 30
                                                  minutes</para>
                                                </listitem>
                                            </itemizedlist>
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>Alignment on hours</para>
                                        <para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>HOURADJ_1, Align to the nearest hour</para>
                                                </listitem>
                                                <listitem>
                                                  <para>HOURADJ_2, Align to the nearest two
                                                  hour</para>
                                                </listitem>
                                                <listitem>
                                                  <para>HOURADJ_3, Align to the nearest three
                                                  hour</para>
                                                </listitem>
                                                <listitem>
                                                  <para>HOURADJ_4, Align to the nearest four
                                                  hour</para>
                                                </listitem>
                                                <listitem>
                                                  <para>HOURADJ_6, Align to the nearest six
                                                  hour</para>
                                                </listitem>
                                                <listitem>
                                                  <para>HOURADJ_12, Align to the nearest tolw
                                                  hour</para>
                                                </listitem>
                                            </itemizedlist>
                                        </para>
                                    </listitem>
                                </orderedlist>
                            </para>
                        </listitem>
                        <listitem>
                            <para><code>DateScale::SetDateAlign($aStartAlign,$aEndAlign)</code></para>
                            <para>The following symbolic constants can be used to define the date
                                alignment</para>
                            <para>
                                <orderedlist>
                                    <listitem>
                                        <para>Day alignment</para>
                                        <para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>DAYADJ_1, Align on the start of a day</para>
                                                </listitem>
                                                <listitem>
                                                  <para>DAYADJ_7, Align on the start of a
                                                  week</para>
                                                </listitem>
                                                <listitem>
                                                  <para>DAYADJ_WEEK, Synonym to DAYADJ_7</para>
                                                </listitem>
                                            </itemizedlist>
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>Monthly alignment</para>
                                        <para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>MONTHADJ_1, Align on a month start</para>
                                                </listitem>
                                                <listitem>
                                                  <para>MONTHADJ_6, Align on the start of
                                                  halfyear</para>
                                                </listitem>
                                            </itemizedlist>
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>Yearly alignment</para>
                                        <para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>YEARADJ_1, Align on a year</para>
                                                </listitem>
                                                <listitem>
                                                  <para>YEARADJ_2, Align on a bi-yearly basis</para>
                                                </listitem>
                                                <listitem>
                                                  <para>YEARADJ_5, Align on a 5 year basis</para>
                                                </listitem>
                                            </itemizedlist>
                                        </para>
                                    </listitem>
                                </orderedlist>
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>Some examples will clarify the use of these methods.</para>
                <para>
                    <example>
                        <title>We want the time adjustment to start on an even quarter of an hour,
                            i.e. an even 15 minute period.</title>
                        <programlisting>$graph->xaxis->scale->SetTimeAlign( MINADJ_15 ); </programlisting>
                    </example>
                </para>
                <para>
                    <example>
                        <title>We want the time to start on an even 2 hour</title>
                        <programlisting>$graph->xaxis->scale->SetTimeAlign( HOURADJ_2 ); </programlisting>
                    </example>
                </para>
            </sect2>
            <sect2>
                <title>Manually adjusting the ticks</title>
                <para>Since a date scale is special case of an integer scale (the underlying format
                    of dates a timestamps which are large integers) it is perfectly possible to
                    manually adjust the interval between each label. The interval is specified in
                    seconds with a call to the usual</para>
                <para><code>LinearTicks::Set($aMajorTicks,$aMinorTick)</code></para>
                <para>as the following code snippet shows</para>
                <para>
                    <programlisting>&lt;?php
$graph->SetScale('datint');

// Adjust the start time for an "even" 5 minute, i.e. 5,10,15,20,25, ...
$graph->xaxis->scale->SetTimeAlign(MINADJ_5);

// Force labels to only be displayed every 5 minutes
$graph->xaxis->scale->ticks->Set(5*60);

// Use hour:minute format for the labels
$graph->xaxis->scale->SetDateFormat('H:i');
?></programlisting>
                </para>
                <para>In the above example the scale will start on an "even" 5 minute boundary and
                    then have labels every 5 minutes exactly. Of course strictly speaking the
                    adjustment with <code>MINADJ_5</code> is not necessary but will avoid that the
                    scale starts on whatever happens to be the initial value of the data (which will
                    control how the first label is placed).</para>
                <para>The graph in <xref xlink:href="#fig.datescaleticksex01"/> shows an example
                    where an online auction is displaying how the bids are increasing from each
                    participant every 5 minutes. The example also shows how to adjust the label
                    format on the y-axis to show currency values with 1000' separator by using a
                    label callback (using the PHP function <code>number_format()</code> ).</para>
                <para>
                    <programlisting>#=datescaleticksex01|Manually adjusting the tick labels for a date scale#</programlisting>
                </para>
            </sect2>
            <sect2>
                <title>Adjusting the label format</title>
                <para>The default label format always tries to use the shortest possible unique
                    string. To manually set a label format the method </para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>DateScale::SetDateFormat($aFormatString)</code></para>
                            <para>The format string uses the same format convention as the PHP
                                function <code>date()</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>is used. For example </para>
                <para>
                    <programlisting>$graph->xaxis->scale->SetDateFormat( 'H:i' ); </programlisting>
                </para>
                <para>will display the hour (24h) and minutes in the label separated by a colon
                    (':'). Using this format string together with the modified start/end alignment </para>
                <para>
                    <programlisting>$graph->xaxis->scale->SetTimeAlign(MINADJ_10);</programlisting>
                </para>
                <para>with our previous date example will give the result shown in <xref
                        xlink:href="#fig.dateaxisex4"/></para>
                <para>
                    <programlisting>#=dateaxisex4|Adjusting label formatting of a date scale#</programlisting>
                </para>
            </sect2>
            <sect2>
                <title>Adjusting the automatic density of date labels</title>
                <para>As with the linear scale it is possible to indicate what density of scale
                    ticks is needed. This is (as usual) specified with a call to
                        <code>Graph::SetTickDensity($aMajDensity, $aMinDensity)</code> for example
                    as</para>
                <para>
                    <programlisting>$graph->SetTickDensity( TICKD_DENSE ); </programlisting>
                </para>
            </sect2>
            <sect2>
                <title>Creating a date/time scale with a manual label call-back</title>
                <para>In the following we will assume that all data points are specified by a tuple
                        <emphasis role="italic">(time-value, date-value)</emphasis> where the
                    date/time is specified as a timestamp in seconds in the same format as is
                    returned by the PHP function <code>time()</code>.</para>
                <para>
                    <caution>
                        <para>Be careful if data is gathered from a different time zone and whether
                            it is given in UTC ot in the local time/date.</para>
                    </caution>
                </para>
                <para>A label formatting callback routine will get called each time a label is to be
                    drawn on the scale. The one parameter given to the callback function is the
                    current time value. The returned string is then used as a label.</para>
                <para>What we do is that we specify that the x-scale should be an ordinary integer
                        <code>"int"</code> scale (remember that the data values are timestamps which
                    are integers). We then install our custom label formatting callback (with a call
                    to <code>Graph::SetLabelFormatCallback()</code>) which given a timestamp returns
                    a suitable label as a string. </para>
                <para>In our example we will use the PHP function <code>date()</code> to convert
                    between the time stamp value and a suitable textual representation of the
                    time/date value.</para>
                <para>The callback we use is</para>
                <para>
                    <programlisting>// The callback that converts timestamp to minutes and seconds
function  TimeCallback ( $aVal ) {
    return  Date ( 'H:i:s' , $aVal );
} </programlisting>
                </para>
                <para>Using some random data we can now generate the graph shown in <xref
                        xlink:href="#fig.dateaxisex1"/></para>
                <para>
                    <programlisting>#=dateaxisex1|Manually creating a date scale#</programlisting>
                </para>
                <para>In the above example we have specified the x-scale manually to make sure that
                    the min/max values on the X-axis exactly matches the min/max x-data values to
                    not leave gaps (as discussed above) between the data and the start/end of the
                    scale.</para>
                <para>The defined callback function will be called for each of the displayed labels.
                    Since we are using an integer scale the labels will be set according to an
                    suitable scale when the time stamp values are interpretated as integers.</para>
                <para>Using integer scales this will not work very well since the library determines
                    label positions to be at even positions (e.g. every 2,5,10, 20,50,100 etc) to
                    suit the auto-scaling since the library will assume that the data is integers
                    and not time stamp values.</para>
                <para>The best way to solve this is to use an integer x-scale together with a
                    callback function with a manually specified scale. </para>
                <para>In order to setup the scale a bit of manually work is needed. Depending on the
                    data to be displayed one should ensure that the scale starts and ends at
                    suitable times and that the tick interval chosen fits with an even multiple of
                    minutes, hours, days or what is best suited for the time range that is to be
                    displayed.</para>
                <para>The following code example illustrates this. It creates some "fake" data that
                    is assumed to be sampled time based data and sets up some suitable scales and
                    tick interval. This script may be used as a basis for more advanced handling of
                    the time data.</para>
                <para>
                    <programlisting>#:timestampex01|Manually creating a date/time scale#</programlisting>
                </para>
            </sect2>
            <sect2>
                <title>Using the "DateScaleUtils" class to make manual date scale</title>
                <para>In this section we will show a very common use case where the x-axis have the
                    unit of timestamps and where the start of each month is labeled. This is
                    difficult (impossible) to do with the automatic tick marks since this requires
                    the distance between consecutive tick marks to be different.</para>
                <para>
                    <warning>
                        <para>To use manual tick marks the basic scale should be an integer scale
                            since the underlying data are integer time stamps, for example
                                <code>SetScale('intlin')</code>.</para>
                    </warning>
                </para>
                <para>
                    <xref xlink:href="#fig.manualtickex1a"/> shows a basic example of what we want
                    to achieve </para>
                <para>
                    <programlisting>#=manualtickex1a|Adding a label at the start of every month#</programlisting>
                </para>
                <para>To use the manual tick marks two steps are required </para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para>Determine where the tick marks should be. Both major (which can
                                have a label and grid marks) and minor ticks can be specified.
                                Optionally if complex labels, which cannot be calculated by a format
                                string (either as date or <code>printf()</code> format) needs to be
                                created.</para>
                        </listitem>
                        <listitem>
                            <para>Call the appropriate method to set the tick marks and optional
                                labels. </para>
                        </listitem>
                    </orderedlist>
                </para>
                <para>We remind the reader that the following methods (in class Axis) are available
                    to set the tick marks </para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::SetTickPositions($aMajTickPos,$aMinTickPos=NULL,$aLabels=NULL)</code></para>
                        </listitem>
                        <listitem>
                            <para><code>Axis::SetMajTickPositions($aMajTickPos,$aLabels=NULL)</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>The second method above is strictly speaking not necessary, it is just a
                    convenience function for those cases where only major ticks and labels should be
                    set. </para>
                <para>The following related method will also be used in this example </para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Axis::SetLabelFormatString($aFormat,$aIsDateFormat=FALSE)</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>This method has been available for a long time in the library but it has
                    recently gained the second argument. With this argument it is possible to tell
                    if the formatting string should be interpretated as format according to the
                    standard <code>printf()</code> format or if it should be interpretated as a
                    format string to be used with the <code>date()</code> function. </para>
                <para>Finally we will use a utility function that is available in
                        "<filename>jpgraph_utils.inc.php</filename>" in the class
                        <code>DateScaleUtils</code></para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>DateScaleUtils::GetTicks($aData,$aType==DSUTILS_MONTH1)</code></para>
                            <para>Possible values for the second argument ($aType) are </para>
                            <para>
                                <informaltable frame="all">
                                    <tgroup cols="2">
                                        <colspec colname="c1" colnum="1"/>
                                        <colspec colname="c2" colnum="2"/>
                                        <thead>
                                            <row>
                                                <entry>Date type</entry>
                                                <entry>Description</entry>
                                            </row>
                                        </thead>
                                        <tbody>
                                            <row>
                                                <entry><code>DSUTILS_MONTH</code></entry>
                                                <entry>Major and minor ticks on a monthly basis
                                                </entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_MONTH1</code></entry>
                                                <entry>Major and minor ticks on a monthly
                                                  basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_MONTH2</code></entry>
                                                <entry>Major ticks on a bi-monthly basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_MONTH3</code></entry>
                                                <entry>Major ticks on a tri-monthly basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_MONTH6</code></entry>
                                                <entry>Major on a six-monthly basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_WEEK1</code></entry>
                                                <entry>Major ticks on a weekly basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_WEEK2</code></entry>
                                                <entry>Major ticks on a bi-weekly basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_WEEK4</code></entry>
                                                <entry>Major ticks on a quad-weekly basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_DAY1</code></entry>
                                                <entry>Major ticks on a daily basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_DAY2</code></entry>
                                                <entry>Major ticks on a bi-daily basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_DAY4</code></entry>
                                                <entry>Major ticks on a quad-daily basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_YEAR1</code></entry>
                                                <entry>Major ticks on a yearly basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_YEAR2</code></entry>
                                                <entry>Major ticks on a bi-yearly basis</entry>
                                            </row>
                                            <row>
                                                <entry><code>DSUTILS_YEAR5</code></entry>
                                                <entry>Major ticks on a five-yearly basis</entry>
                                            </row>
                                        </tbody>
                                    </tgroup>
                                </informaltable>
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>The <code>DateScaleUtils::GetTicks()</code> is a utility function that given
                    an array of timestamps returns an array of major and minor tick mark positions
                    that marks the start and middle of each month when we use the
                        <code>DSUTILS_MONTH1</code> type specifier.</para>
                <para>To make the graph in figure 1 we first note that it is probably a good idea to
                    specify the min and max value of the X-axis ourself rather than letting the auto
                    scale algorithm do that. Since the timestamps are possibly quite large values
                    and the auto scaling algorithm will try to make the start and end values be
                    "even" (for example multiples of 5,10,100, .. and so on). </para>
                <para>Secondly we need to chose what scale we will use. In this case it doesn't
                    really matter if we chose a integer (int) or a linear (lin) scale. But since
                    timestamps by definition are integers we select an int scale for the X-axis. </para>
                <para>Finally we need to decide what format to have on the labels. For this example
                    we chose to show it as "Dec05" to indicate "December 2005". The format string
                    needed to select this is "<code>My</code>" which we will use as argument for the
                        <code>SetLabelFormatString()</code> method. Since the width of the label is
                    medium wide we add some empty space on each side of the graph after we
                    positioned the ticks to avoid the first label "hitting" the Y-axis labels. This
                    could happen if the start of the first month on the axis is very near the X-Y
                    axis conjunction. </para>
                <para>We will now walk through the code to create the image in <xref
                        xlink:href="#fig.manualtickex1a"/> and explain each step. </para>
                <para>First we create some random data for the X and Y axis </para>
                <para>
                    <programlisting>&lt;?php
$datay = array();
$datax = array();
$ts = time();
$n=15; // Number of data points
for($i=0; $i &lt; $n; ++$i ) {
    $datax[$i] = $ts+$i*700000; 
    $datay[$i] = rand(5,60);
}
?></programlisting>
                </para>
                <para>Then we get the tick positions for the start of the months </para>
                <para>
                    <programlisting>&lt;?php
list($tickPositions, $minTickPositions) = DateScaleUtils::GetTicks($datax);
?></programlisting>
                </para>
                <para>We also add a bit of space "grace value" at the beginning and end of the axis </para>
                <para>
                    <programlisting>&lt;?php
$grace = 400000;
$xmin = $datax[0]-$grace;
$xmax = $datax[$n-1]+$grace;
?></programlisting>
                </para>
                <para>It is now time to add the standard code to setup a basic graph. We also set
                    the previously calculated tick positions and the label formatting string we want
                    to use. </para>
                <para>Note that we are careful at making sure the x-axis always start at the minimum
                    y-value (by calling <code>SetPos()</code> ), by default the x-axis is otherwise
                    positioned at y=0 and if the y-scale happens to start at, say y=10, then the
                    x-axis is not shown. </para>
                <para>
                    <programlisting>&lt;?php
$graph = new Graph(400,200);
$graph->SetScale('intlin',0,0,$xmin,$xmax);
$graph->title->Set('Basic example with manual ticks');
$graph->title->SetFont(FF_ARIAL,FS_NORMAL,12);
$graph->xaxis->SetPos('min');
$graph->xaxis->SetTickPositions($tickPositions,$minTickPositions);
$graph->xaxis->SetLabelFormatString('My',true);
$graph->xaxis->SetFont(FF_ARIAL,FS_NORMAL,9);
$graph->xgrid->Show();
?></programlisting>
                </para>
                <para>Finally we create and add the plot to the graph and send back the graph to the
                    browser. </para>
                <para>
                    <programlisting>&lt;?php
$p1 = new LinePlot($datay,$datax);
$p1->SetColor('teal');
$graph->Add($p1);
$graph->Stroke();
?></programlisting>
                </para>
            </sect2>
            <sect2>
                <title>When to use manual and when to use automatic date scale?</title>
                <para>The previous sections showed how to make use of the utility class
                        <code>DateScaleUtils</code> to manually set the tick marks. The astute
                    reader will also recall the possibility to use a "date" scale, i.e. specifying
                    the scale for example as</para>
                <para>
                    <programlisting>&lt;?php
// Use a date-integer scale
$graph->SetScale('datint'); 
?></programlisting>
                </para>
                <para>So what is the difference and when should this be used?</para>
                <para>The answer is that the functionality to some extent overlap but with the
                    manual scale creation there is the possibility to more exact specify the
                    distance between the label marks. By using the "Date" scale the library will
                    automatically adjust the labels to have a suitable distance depending on the
                    span of the data and the size of the graph. This is "easier" but will give
                    little control over the intervals.</para>
                <para>With the manual scale, on the other hand, it is possible to exactly specify
                    the distance (e.g. every three month) between each label on the expense of a few
                    more lines of code.</para>
                <para>There is also one more important difference an that is that with a "date"
                    scale the tick marks will always be adjusted so that the end and beginning of
                    the scale falls on a major tick marks. If the data to be visualized doesn't
                    completely cover this span there might be "gaps" in the data at the beginning
                    or/and at the end of the x-scale. With a manual scale it is possible to set the
                    min and max x-scale value to match exactly the min/max x-values in the data and
                    have the plot begin and end at exactly the beginning and end of the x-axis. This
                    is not possible to guarantee with a date scale.</para>
                <para>Let's put this knowledge to use and compare "side by side" the difference
                    between these two ways of creating a date scale by creating a graph with the
                    same data but using these two different methods.</para>
                <para>In the first example (shown in <xref xlink:href="#fig.dateutilex01"/>) we use
                    a manually set tick scale with an explicitly set min/max value for the x-axis.
                    The labels on the graph are formatted with a call to</para>
                <para>
                    <programlisting>$graph->xaxis->SetLabelFormatString('M, Y',true);</programlisting>
                </para>
                <para>the second parameter (<code>'true'</code>) will make the library interpret the
                    format string as specifying a date format string.</para>
                <para>
                    <programlisting>#=dateutilex01|Manually specified date scale#</programlisting>
                </para>
                <para>The second variant will use the exact same data but this time we will use a
                    date scale. This is accomplished by first including the necessary support module
                    jpgraph_date.php and then specifying the scale as</para>
                <para>
                    <programlisting>$graph->SetScale('datlin');</programlisting>
                </para>
                <para>In order to make the two graphs have exactly the same label format we also use
                    the same format string as in the previous graph, i.e.
                        <code>$graph->xaxis->SetLabelFormatString('M, Y',true);</code>. The result
                    of formatting is shown in <xref xlink:href="#fig.dateutilex02"/>.</para>
                <para>
                    <programlisting>#=dateutilex02|Using an automatic date scale#</programlisting>
                </para>
                <para>Comparing <xref xlink:href="#fig.dateutilex02"/>. and <xref
                        xlink:href="#fig.dateutilex01"/> we can see that with the automatic scaling
                    the tick marks match the beginning and ending of the x-scale but at the expense
                    of a small gap at the end of the data since the data doesn't extend quite as far
                    as the scale.</para>
            </sect2>
        </sect1>
        <sect1>
            <title>Adding shearing image transformation to the graph</title>
            <para>As a final "touch" on the image it is possible to apply a shearing transformation
                to the generated image. This can be used to give the image a "3D" perspective. The
                transformation is done by the method <code>Graph::Set3DPerspective()</code> It
                should be noted that since these transformations are all done in PHP they are (as
                all image processing) quite processor intensive.</para>
            <para>In order to get access to the transformation functionality the module
                    "<filename>jpgraph_imgtrans.php</filename>" must first be included in the
                script. </para>
            <para>In <xref xlink:href="#fig.shearing-types"/> the original image is shown in the
                middle and the four types of shearing is shown around in positions indicating the
                type of shearing. The symbolic name for the type of shearing is shown below each
                image.</para>
            <para>
                <figure xml:id="fig.shearing-types">
                    <title>Different types of shearing transformation</title>
                    <informaltable frame="none">
                        <tgroup cols="3">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <colspec colname="c3" colnum="3"/>
                            <tbody>
                                <row>
                                    <entry namest="c1" nameend="c3" align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/shear0.png"
                                                /></imageobject></inlinemediaobject></para>
                                        <para><code>SKEW3D_UP</code></para>
                                    </entry>
                                </row>
                                <row>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/shear2.png"
                                                /></imageobject></inlinemediaobject></para>
                                        <para><code>SKEW3D_LEFT</code></para>
                                    </entry>
                                    <entry valign="middle" align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/shear-original.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para>[Original graph]</para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/shear3.png"
                                                /></imageobject></inlinemediaobject></para>
                                        <para><code>SKEW3D_RIGHT</code></para>
                                    </entry>
                                </row>
                                <row>
                                    <entry namest="c1" nameend="c3" align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/shear1.png"
                                                /></imageobject></inlinemediaobject></para>
                                        <para><code>SKEW3D_DOWN</code></para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </figure>
            </para>
            <para>The transformation is specified with the method</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para><code>Graph::Set3DPerspective($aDir,$aAlpha=100,$aShear=120,$aQuality=false,$aFillColor='#FFFFFF',$aBorder=false,$aMinSize=true,$aHorizonPos=0.5)</code></para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <figure xml:id="fig.shearing-parameters">
                    <title>Explaining the shearing parameters</title>
                    <mediaobject>
                        <imageobject><imagedata fileref="images/shearing-params.png" scale="70"
                            /></imageobject>
                    </mediaobject>
                </figure>
            </para>
            <para>The different parameters that effect the transformation can now be explained with
                the help of <xref xlink:href="#fig.shearing-parameters"/>
            </para>
            <para>
                <variablelist>
                    <varlistentry>
                        <term><emphasis role="bold"><code>$aDir</code></emphasis></term>
                        <listitem>
                            <para>This is the symbolic constant to define which of the four basic
                                types of transformation as shown in <xref
                                    xlink:href="#fig.shearing-types"/>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term><emphasis role="bold"><code>$aAlpha</code></emphasis></term>
                        <listitem>
                            <para>This defines the distance from the bottom of the image to the
                                artificial horizon </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term><emphasis role="bold"><code>$aShear</code></emphasis></term>
                        <listitem>
                            <para>This defines from the perspective vanish point on the artificial
                                horizon to the crossing of the "shearing line" on the artificial
                                horizon..</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term><emphasis role="bold"><code>$aHorizPos</code></emphasis></term>
                        <listitem>
                            <para>This specifies the distance from the left edge of the image to the
                                perspective vanish point</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term><emphasis role="bold"><code>$aQuality</code></emphasis></term>
                        <listitem>
                            <para>With this parameter set to <emphasis role="bold">true</emphasis>
                                the algorithm will do additional image interpolation to increase the
                                quality of the resulting transformation on the expense of further
                                processing time.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term><emphasis role="bold"><code>$aFillColor</code></emphasis></term>
                        <listitem>
                            <para>Specifies the background fill color to be used. A value of false
                                (the default) indicates no fill</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term><emphasis role="bold"><code>$aBorder</code></emphasis></term>
                        <listitem>
                            <para>Add a border around the transformed image</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term><emphasis role="bold"><code>$aMinSize</code></emphasis></term>
                        <listitem>
                            <para>The transformed image is usually smaller than the original image
                                and if this parameter is set to true then the resulting image will
                                be as small as it can be. If it is false then the original image
                                size will be kept.</para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </para>
            <para>This might be regarded as "gimmick" factor but has proven useful in batch
                (off-line) processing to produce a sequence of images that gives the appearance of a
                graph that rotates into place. </para>
        </sect1>
        <sect1>
            <title>Rotating graphs</title>
            <para>The library supports an arbitrary rotation of a the plot area as well as some
                special convenience method to rotate the plot area 90 degree which most often is
                used to draw a horizontal bar graph instead of a (standard) vertical bar
                graph.</para>
            <para>
                <caution>
                    <para>Adding a rotation transformation will make the graph generation slightly
                        slower since each point of the graph as to go through a transformation step
                        before being stroked on to the image. The library tries to mitigate this as
                        much as possible by using a pre-calculated transformation matrix and also
                        makes further optimizations for the special case of 90 degree
                        rotations.</para>
                </caution>
            </para>
            <para>
                <caution>
                    <para>Any background images (see <xref xlink:href="#sec2.img-country-background"
                        />) will not be rotated with the graph. This limitation exists since the
                        performance and memory usage of doing real image transformation in PHP would
                        be too poor. Any background images needing rotation must be rotated outside
                        in some image manipulation program (e.g. Gimp, IrfanView).</para>
                </caution>
            </para>
            <para>When a plot area is rotated there are two things to be aware of </para>
            <para>
                <orderedlist>
                    <listitem>
                        <para><emphasis role="italic">individual labels on the axis are not
                                rotated</emphasis></para>
                        <para>The design decision behind this is that bit mapped fonts cannot be
                            arbitrarily rotated and rotating TTF fonts will decrease (in general)
                            the readability. If angle rotation is needed on the labels it is still
                            possible to use the method <code>Axis::SetLabelAngle()</code></para>
                        <para>
                            <note>
                                <para>Since the anchor point for labels is by default the optimum
                                    for graph at 0 degree the anchor point and alignment for the
                                    labels on the axis should probably be adjusted to get a better
                                    visual appearance on the rotated graph. This is accomplished by
                                    the method <code>Axis::SetLabelAlign()</code>
                                </para>
                            </note>
                        </para>
                    </listitem>
                    <listitem>
                        <para><emphasis role="italic">any background image or background gradient is
                                not rotated</emphasis></para>
                        <para>The design decision behind this is purely computational Doing a full
                            image rotation would be excruciating CPU intensive using PHP.</para>
                    </listitem>
                </orderedlist>
            </para>
            <sect2>
                <title>Free rotation of the plot area</title>
                <para>The rotation of the plot area is controlled with the following two methods </para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Image::SetAngle($aAngle)</code></para>
                            <para>"<code>$Angle</code>" = Angle of rotation specified in degrees. A
                                positive angle specifies a clockwise rotation.</para>
                        </listitem>
                        <listitem>
                            <para><code>Image::SetCenter($aX, $aY)</code></para>
                            <para>Specifies the center of rotation</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>The Image class is the lowest graphic layer in the library and it is access
                    through the instance variable "<code>$img</code>" of the Graph class. So for
                    example to rotate a plot are 45 degree the following line has to be added</para>
                <para>
                    <programlisting>$graph->img->SetAngle(45);</programlisting>
                </para>
                <para>By default the center of rotation will be the center point of the plot area.
                    The following examples will clarify this. We will use the (very) basic graph
                    shown in <xref xlink:href="#fig.rotex0"/> to demonstrate rotation.</para>
                <para>
                    <programlisting>#=rotex0|Original unrotated graph#</programlisting>
                </para>
                <para>In <xref xlink:href="#fig.rotex1"/> and <xref xlink:href="#fig.rotex2"/> we
                    have rotated the plot area around (the default) the center of the plot
                    area</para>
                <para>
                    <informaltable frame="none">
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <tbody>
                                <row>
                                    <entry>
                                        <para>
                                            <programlisting>#=rotex1|Rotating the plot area 45 degrees#</programlisting>
                                        </para>
                                    </entry>
                                    <entry>
                                        <para>
                                            <programlisting>#=rotex2|Rotating the plot area 90 degrees#</programlisting>
                                        </para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </para>
                <para>In the above two example the center of the rotation was the center point of
                    the plot area. If we instead change the center of rotation to be the center of
                    the entire graph we get the result shown in <xref xlink:href="#fig.rotex3"/> and
                        <xref xlink:href="#fig.rotex4"/> . </para>
                <para>
                    <informaltable frame="none">
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <tbody>
                                <row>
                                    <entry>
                                        <para>
                                            <programlisting>#=rotex3|Rotating the plot area 45 degrees#</programlisting>
                                        </para>
                                    </entry>
                                    <entry>
                                        <para>
                                            <programlisting>#=rotex4|Rotating the plot area 90 degrees#</programlisting>
                                        </para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </para>
                <para>As a final example in <xref xlink:href="#fig.rotex5"/> we show the result of
                    rotating the plot area -30 degree around the bottom left point in the
                    graph</para>
                <para>
                    <programlisting>#=rotex5|Rotating the plot area -30 degree around the bottom left corner#</programlisting>
                </para>
            </sect2>
            <sect2>
                <title>Rotating the plot area 90 degree</title>
                <para>As can be seen above in <xref xlink:href="#fig.rotex2"/> and <xref
                        xlink:href="#fig.rotex4"/> the rotation does not alter the overall size and
                    margin of the graph even though we probably should do so in order to better
                    accommodate the rotated plot areas topography. It is of course perfectly
                    possible to adjust the size of the graph manually.</para>
                <para>The slight complication with general rotation is that the margins also
                    rotates, this means that if the graph is rotated 90 degrees the left margin in
                    the image was originally the bottom margin. In additional by default the center
                    of the rotation is the center of the plot area and not the entire image (if all
                    the margins are symmetrical then they will of course coincide). This means the
                    center of the rotation will move with the margin (since the specify the exact
                    location of the plot area)..</para>
                <para>So for the case of rotating a graph 90 degree the library provides a
                    convenience method to do both the rotation and specifying the margin at the same
                    time (to avoid the mental exercise described above) by providing the
                    method</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Set90AndMargin(($aLeft=0,$aRight=0,$aTop=0,$aBottom=0)
                                </code></para>
                            <para>Rotates the plot area 90 degrees and sets the graph margin
                                areas</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>This method is probably most commonly used with bar graphs to create
                    horizontal instead of vertical bars. See the section on bar graphs, ??, for more
                    example on this.</para>
            </sect2>
        </sect1>
        <sect1>
            <title>Using anti-aliasing in the graph generation</title>
            <para>The library have partial support for the use of anti-aliasing when crating graphs.
                The level of support is different depending on the actual graph type and there are
                some caveats to be aware of.</para>
            <para>
                <note>
                    <para>One question that is often asked is why does the library not support full
                        anti-aliasing in every type of graphs? The answer is that since neither GD
                        graphic library does not support real anti-aliasing this is done in the
                        library itself most of the time. Doing full image anti-aliasing is very CPU
                        intensive and can for large graph easily take four times longer than no
                        anti-aliasing. In addition the way full image anti-aliasing is done is by
                        creating larger canvas which the graph is drawn on and then do a smoothing
                        operation, basically scale the image to the correct size puts some
                        limitation on the details resolution. For example text needs special
                        handling since the TTF fonts are already anti-aliased and cannot be
                        re-anti-aliased a second time.</para>
                </note>
            </para>
            <sect2>
                <title>Anti-aliasing for line drawing graphs</title>
                <para>This applies to all graphs that makes use if line drawing. For example line
                    plots and radar charts. This is the only "true" anti-aliasing done in the
                    library. </para>
                <para>This anti aliasing is enabled by calling the method</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>Image::SetAntiAliasing($aFlg=true)</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>As a concrete example the following line can be used to enable anti-aliasing
                    for both line and wind rose plots</para>
                <para>
                    <programlisting>$graph->img->SetAntiAliasing();</programlisting>
                </para>
                <para>The algorithm used for line anti-aliasing makes a gradient color transition
                    between foreground line color and background while plotting a line using a
                    standard mid-point line algorithm. To achieve best visual result always use a
                    dark line color on a light colored background.</para>
                <para>The images below shows the difference between a plain graph on the left and
                    the same graph drawn with anti-aliasing enabled on the right.</para>
                <para>
                    <informaltable frame="none">
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <tbody>
                                <row>
                                    <entry>
                                        <programlisting>#=radarex8|Plain radar plot#</programlisting>
                                    </entry>
                                    <entry>
                                        <programlisting>#=radarex8.1|Anti-aliased radar plot#</programlisting>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </para>
                <para>There are a number of limitations with the current implementation that should
                    be noted. The reason these limitation exists is that for reasons of CPU load we
                    have chosen not to implement full anti-aliasing for arbitrary shapes. </para>
                <para>
                    <orderedlist>
                        <listitem>
                            <para>Speed! Doing anti-aliased lines in PHP is not cheap. Anti-aliased
                                line drawing is roughly 6-8 times slower then lines without
                                anti-aliasing So using anti-aliasing isn't suitable together with
                                high-load often updated graphs. Remember to use the caching feature
                                (see <xref xlink:href="#sec.efficient-graph-generation"/>.)</para>
                        </listitem>
                        <listitem>
                            <para>Lines will ignore any width and only have a single line-width of
                                approximately=1. It is not possible to set the line width when
                                anti-alias is used. (This would require a full implementation of
                                anti-aliased polygons which is not implemented.) </para>
                        </listitem>
                        <listitem>
                            <para>The colors will be a little bit "weaker" since they will now not
                                consist of one dominant color but rather being made up by at least
                                two different colors. </para>
                        </listitem>
                        <listitem>
                            <para>Anti-aliasing does not work very well together with background
                                images since it assumes a the same solid color on each side of the
                                line. Doing a more advanced anti-aliasing algorithm would simple
                                take to much processing power.</para>
                        </listitem>
                        <listitem>
                            <para>Even when anti-aliasing is enabled fast line-drawing will be used
                                for horizontal, vertical and diagonal lines since these get sampled
                                at high enough frequency anyway and doesn't benefit from
                                anti-aliasing. This optimization has a slight visual impact, as can
                                be seen in <xref xlink:href="#fig.radarex8.1"/> The vertical line
                                appear to the human eye to have a slightly different color and looks
                                a bit thinner. </para>
                        </listitem>
                    </orderedlist>
                </para>
                <para>
                    <note>
                        <para>The difference between a standard line and one line with anti-aliasing
                            is shown in large magnification in ??. The approach used in the library
                            roughly corresponds to an even weighted 3x3 Bartlett-filter. It would be
                            possible to apply some more advanced filtering techniques to achieve an
                            even better result but doing high-intensive 2D signal processing on a
                            HTTP-server is not a brilliant idea. The algorithm used in the library
                            is a reasonable trade-off between visual appearance and
                            efficiency.</para>
                        <para>
                            <figure>
                                <title>Anti-aliasing up-close. The figure shows the difference
                                    between a standard line (on-top) and the corresponding
                                    anti-aliased line (on-the bottom)</title>
                                <informaltable frame="none">
                                    <tgroup cols="1">
                                        <colspec colname="c1" colnum="1"/>
                                        <tbody>
                                            <row>
                                                <entry align="center">
                                                  <para><inlinemediaobject><imageobject><imagedata
                                                  scale="70" fileref="images/aalias_line.jpg"
                                                  /></imageobject></inlinemediaobject></para>
                                                </entry>
                                            </row>
                                        </tbody>
                                    </tgroup>
                                </informaltable>
                            </figure>
                        </para>
                    </note>
                </para>
                <para/>
            </sect2>
            <sect2>
                <title>Anti-aliasing in pie graphs</title>
                <para>For Pie plots a full image anti-aliasing algorithm is used. The original image
                    is scaled to twice it's specified with and then down sampled to the required
                    size. This will give a low pass filtering effect which takes the edges away from
                    the image and gives a smooth appearance. However the filtering is quite
                    processor intensive.</para>
                <para>Anti-aliasing for pie plots are enabled by calling</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><code>PieGraph::SetAntiAlising($aFlg=true)</code></para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>as the following code snippet shows</para>
                <para>
                    <programlisting>$piegraph->SetAntiAliasing();</programlisting>
                </para>
                <para>There is inherent limitation using this method and that is that edges on the
                    Pie can not be used. </para>
                <para>The figure below shows the visual impact the anti-aliasing have on both 2D and
                    3D Pie plots.</para>
                <para>
                    <figure>
                        <title>Affects of using anti-alias for Pie-graphs</title>
                        <informaltable frame="none">
                            <tgroup cols="2">
                                <colspec colname="c1" colnum="1"/>
                                <colspec colname="c2" colnum="2"/>
                                <tbody>
                                    <row>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  fileref="images/pie2dnoaa.png" scale="70"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  fileref="images/pie2daa.png" scale="70"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  fileref="images/pie3dnoaa.png" scale="70"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                        <entry>
                                            <para><inlinemediaobject><imageobject><imagedata
                                                  fileref="images/pie3daa.png" scale="70"
                                                  /></imageobject></inlinemediaobject></para>
                                        </entry>
                                    </row>
                                </tbody>
                            </tgroup>
                        </informaltable>
                    </figure>
                </para>
            </sect2>
            <sect2>
                <title>Anti-aliasing in Windrose plots</title>
                <para>This uses the same algorithm as the Pie plots with similar restrictions and
                    limitations.</para>
            </sect2>
            <sect2>
                <title>Anti-aliasing for Contour plots</title>
                <para>This uses almost the same algorithm as Pie plots. The additional feature here
                    is that it is possible to specify the size of the over-sampling. This can be
                    value between 2-5. However, using an oversampling larger than 3 has very little
                    additional visual improvement but will significantly increase the processing
                    time. </para>
            </sect2>
        </sect1>
        <sect1 xml:id="sec.adding-icons-to-graph">
            <title>Adding icons (and small images) to the graph</title>
            <para>In addition to the standard background image you can also add an arbitrary number
                of icons onto the background of the graph. These icons are created with a call to
                the special Plot <code>class IconPlot</code> defined in the module
                    "<filename>jpgraph_iconplot.php</filename>". The image which is the base of the
                icons can be </para>
            <para>
                <orderedlist>
                    <listitem>
                        <para>an arbitrary image from a file</para>
                    </listitem>
                    <listitem>
                        <para>one of the built-in country flags</para>
                    </listitem>
                </orderedlist>
            </para>
            <para>The basic structure of adding an icon somewhere on the graph is to first create an
                instance of the IconPlot class and then position the icon at the wanted x,y-position
                on the graph and finally add the object to the graph using the standard
                    <code>Graph::Add()</code> method. The constructor for the IconPlot class have
                the following signature</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para><code>__construct($aFile='',$aX=0,$aY=0,$aScale=1.0,$aMix=100)</code></para>
                        <para>The parameters should be self explanatory. The <code>$aMix</code>
                            factor specifies the degree of alpha blending between the background and
                            the icon. A value of 100 means no blending and a value of 0 means that
                            the icon is not shown at all, only the background.</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>Some useful methods in this class are</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para><code>SetCountryFlag($aFlag,$aX=0,$aY=0,$aScale=1.0,$aMix=100,$aStdSize=3)</code></para>
                        <para>This method specifies that the specified country flag should be
                            used</para>
                    </listitem>
                    <listitem>
                        <para><code>SetPos($aX,$aY)</code></para>
                        <para>Same as the optional arguments in th constructor. The coordinates are
                            specified as absolute pixels where (0,0) is the top left corner.</para>
                    </listitem>
                    <listitem>
                        <para><code>CreateFromString($aStr)</code></para>
                        <para>Creates the image from a string instead of reading it from a file.
                        </para>
                    </listitem>
                    <listitem>
                        <para><code>SetScalePos($aX,$aY)</code></para>
                        <para>Specifes the potision using the scale coordinate as specified by the
                            x- and y-scales</para>
                    </listitem>
                    <listitem>
                        <para><code>SetAnchor($aXAnchor='left',$aYAnchor='center')</code></para>
                        <para>Sets the anchor point of the icon, i.e. the position in the icon that
                            should be aligned with the specified icon position in the graph.</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>The following short example shows how an icon is created and added to a
                graph</para>
            <para>
                <programlisting>$icon = new IconPlot('myimage.png',0.2,0.3,1,30);
$icon->SetAnchor('center','center');
$graph->Add($icon);</programlisting>
            </para>
            <para>It is possible to control how much of the icon should be blended into the
                background by specifying a percentage (1-100). The example below in <xref
                    xlink:href="#fig.lineiconex1"/> shows how to mix in the picture of "Tux the
                penguin" into the background of a filled line graph. </para>
            <para>
                <programlisting>#=lineiconex1|Mixing an icon image into the background of the graph. The area plot in the graph uses alpha blending to achieve see-through affect#</programlisting>
            </para>
            <para>To specify any of the roughly 200 country flags as an icon the first step is to
                create an empty Icon and then call the <code>IconPlot::SetCountryFlag()</code>
                method with the appropriate parameters. This is illustrated below by adding the
                Icelandic flag into the background as an icon.</para>
            <para>
                <programlisting>#=lineiconex2|Adding a country flag icon in the background#</programlisting>
            </para>
            <para>
                <caution>
                    <para>Some older versions of PHP (&lt; 4.3.3 using the built-in GD) have
                        problems rendering blended images. If you have this problem then you need to
                        upgrade to a more recent version of PHP.</para>
                </caution>
            </para>
        </sect1>
        <sect1 xml:id="sec2.img-country-background">
            <title>Adding images and country flags to the background of the graph</title>
            <para>The background can not only be a solid (or semi-transperant) color. It is also
                possible to use images as backgrounds. These can be arbitrary user specified images
                in any format (as determined by there file suffix). Since the library has a built in
                support for all established countries (as of 20 Dec 2008) in regards to there flags
                (all flags are encoded within the library) it is also possible to use a country flag
                as a background. This could be considered a special case of the user defined image
                background.</para>
            <para>
                <orderedlist>
                    <listitem>
                        <para><code>Graph::SetBackgroundImage($aFileName,$aBgType=BGIMG_FILLPLOT,$aImgFormat='auto')</code></para>
                    </listitem>
                    <listitem>
                        <para><code>Graph::SetBackgroundImageMix($aMix)</code></para>
                    </listitem>
                    <listitem>
                        <para><code>Graph::SetBackgroundImagePos($aXpos,$aYpos)</code></para>
                    </listitem>
                    <listitem>
                        <para><code>Graph::SetBackgroundCountryFlag($aName,$aBgType=BGIMG_FILLPLOT,$aMix=100)</code></para>
                    </listitem>
                </orderedlist>
            </para>
            <para>For both background images and flags it is possible to define how the image should
                be used on the page with the background type parameters. This parameter specifies
                how the image should be placed on the graph. The following options are
                available:</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>BGIMG_FILLPLOT . This means that the background image will be scaled
                            to that it exactly fits the plot area</para>
                    </listitem>
                    <listitem>
                        <para>BGIMG_FILLFRAME . This means the the background image will be scaled
                            so that it exactly fits the entire graph</para>
                    </listitem>
                    <listitem>
                        <para>BGIMG_COPY . This means that the background image will be copied in
                            tis original size without and size adjustments</para>
                    </listitem>
                    <listitem>
                        <para>BGIMG_CENTER . Almost the same as BGIMG_COPY but this also means that
                            the image will be automatically centered in the graph</para>
                    </listitem>
                    <listitem>
                        <para>BGIMG_FREE, This is a variant of the BGIMG_COPY but in this case the
                            image will be free on its own and have no color blending with the margin
                            color</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>To help explain these types of backgrounds they are illustrated below by adding
                the image in <xref xlink:href="#fig.background-image-for-examples"/> as a background
                to the plain graph in <xref xlink:href="#fig.graph-for-background"/>. In order not
                to have the background image take to much emphasis in the graph we specify the
                mixing to 25% with a call to</para>
            <para>
                <programlisting>$graph->SetBackgroundImageMix(25);</programlisting>
            </para>
            <para>
                <informaltable frame="none">
                    <tgroup cols="2">
                        <colspec colname="c1" colnum="1"/>
                        <colspec colname="c2" colnum="2"/>
                        <tbody>
                            <row>
                                <entry valign="bottom">
                                    <figure xml:id="fig.graph-for-background">
                                        <title>The graph that will be used to add backgrounds
                                            to</title>
                                        <mediaobject>
                                            <imageobject><imagedata
                                                  fileref="images/graph_for_background_example.png"
                                                  scale="70"/></imageobject>
                                        </mediaobject>
                                    </figure>
                                </entry>
                                <entry valign="bottom">
                                    <figure xml:id="fig.background-image-for-examples">
                                        <title>Background image (a closeup of our burnt
                                            server)</title>
                                        <mediaobject>
                                            <imageobject><imagedata fileref="images/heat1.jpg"
                                                  scale="70"/></imageobject>
                                        </mediaobject>
                                    </figure>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </informaltable>
            </para>
            <para>In the table below the various options for adjusting the size and position of the
                background image are shown</para>
            <para>
                <informaltable frame="none">
                    <tgroup cols="2">
                        <colspec colname="c1" colnum="1"/>
                        <colspec colname="c2" colnum="2"/>
                        <tbody>
                            <row>
                                <entry align="center">
                                    <para>
                                        <programlisting>#=background_type_ex0|BGIMG_COPY#</programlisting>
                                    </para>
                                    <para><code>BGIMG_COPY</code></para>
                                </entry>
                                <entry align="center">
                                    <para>
                                        <programlisting>#=background_type_ex1|BGIMG_CENTER#</programlisting>
                                    </para>
                                    <para><code>BGIMG_CENTER</code></para>
                                </entry>
                            </row>
                            <row>
                                <entry align="center">
                                    <para>
                                        <programlisting>#=background_type_ex2|BGIMG_FREE#</programlisting>
                                    </para>
                                    <para><code>BGIMG_FREE</code></para>
                                </entry>
                                <entry align="center">
                                    <para>
                                        <programlisting>#=background_type_ex3|BGIMG_FILLPLOT#</programlisting>
                                    </para>
                                    <para><code>BGIMG_FILLPLOT</code></para>
                                </entry>
                            </row>
                            <row>
                                <entry align="center">
                                    <para>
                                        <programlisting>#=background_type_ex4|BGIMG_FILLFRAME#</programlisting>
                                    </para>
                                    <para><code>BGIMG_FILLFRAME</code></para>
                                </entry>
                                <entry/>
                            </row>
                        </tbody>
                    </tgroup>
                </informaltable>
            </para>
            <para/>
            <sect2>
                <title>Using country flags as backgrounds</title>
                <para>The method <code>Graph::SetBackgroundCountryFlag($aName,$aBgType,$aMix)</code>
                    makes it possible to use an of the built-in country flags as a background i the
                    same way as any other user specified background image. All included country
                    flags as of Dec 2008 are listed in <xref xlink:href="#app.country-flags"/>. The
                    background country flag is specified by its short name as listed in <xref
                        xlink:href="#app.country-flags"/>.</para>
                <para>
                    <caution>
                        <para>The dynamics of world politics and geographic boundaries will no doubt
                            make the list of included countries obsolete almost at the same time the
                            library is released. The intention is that all currently known country
                            and similar geographic entities should be included. Any missing flags
                            shall and can not be interpreted as any political stand it is merely a
                            consequence of political changes since the library was released or a
                            possible oversight or simply a mistake either human or algorithmically
                            in how the country flags are produced. </para>
                    </caution>
                </para>
            </sect2>
        </sect1>
        <sect1>
            <title>Using background gradients</title>
            <para>A color gradient background will change the color from a start color to a finish
                color in even steps (the number of steps depends on the size of the graph). The
                direction of the gradient is controlled by specifying a style parameter for the
                gradient. The signature for the gradient background method is</para>
            <para>
                <orderedlist>
                    <listitem>
                        <para><code>Graph::SetBackgroundGradient($aFrom='navy',$aTo='silver',$aGradType=2,$aStyle=BGRAD_FRAME)</code></para>
                    </listitem>
                </orderedlist>
            </para>
            <para>The last style par mater specified where in the graph the gradient style should be
                applied and the different options are</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para><code>BGRAD_FRAME</code>, The entire graph frame will be filled
                        </para>
                    </listitem>
                    <listitem>
                        <para><code>BGRAD_MARGIN</code>, Only the margin area (the graph area
                            outside the plot area) will be filled</para>
                    </listitem>
                    <listitem>
                        <para><code>GRAD_PLOT</code>, Only the plot area will be filled</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>This is illustrated in <xref xlink:href="#fig.different-gradient-fill-types"
                /></para>
            <para>
                <figure xml:id="fig.different-gradient-fill-types">
                    <title>What area of the graph the gradient should affect</title>
                    <informaltable frame="none">
                        <tgroup cols="3">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <colspec colname="c3" colnum="3"/>
                            <tbody>
                                <row>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_bgrad_frame.png"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para><code>BGRAD_FRAME</code></para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata
                                                  fileref="images/grad_bgrad_margin.png" scale="70"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para><code>BGRAD_MARGIN</code></para>
                                    </entry>
                                    <entry align="center">
                                        <para><inlinemediaobject><imageobject><imagedata
                                                  fileref="images/grad_bgrad_plot.png" scale="70"
                                                  /></imageobject></inlinemediaobject></para>
                                        <para><code>BGRAD_PLOT</code></para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </figure>
            </para>
            <para>The different types of gradient fills are shown in <xref
                    xlink:href="#fig.different-gradient-types"/> where the gradient from color is
                    "<code>white</code>" and the to color is "<code>orange</code>"</para>
            <para>
                <figure xml:id="fig.different-gradient-types">
                    <title>Different types of gradient fills</title>
                    <informaltable frame="none">
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1"/>
                            <colspec colname="c2" colnum="2"/>
                            <tbody>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_vert.png"
                                                /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_hor.png"
                                                /></imageobject></inlinemediaobject></para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_midhor.png"
                                                /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_midver.png"
                                                /></imageobject></inlinemediaobject></para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_wide_midhor.png"
                                                  /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_wide_midver.png"
                                                  /></imageobject></inlinemediaobject></para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_left_reflection.png"
                                                  /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_right_reflection.png"
                                                  /></imageobject></inlinemediaobject></para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_center.png"
                                                /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_raised_panel.png"
                                                  /></imageobject></inlinemediaobject></para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para><inlinemediaobject><imageobject><imagedata scale="70"
                                                  fileref="images/grad_diagonal.png"
                                                /></imageobject></inlinemediaobject></para>
                                    </entry>
                                    <entry/>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                </figure>
            </para>
            <sect2>
                <title>Generating gradient background off-line</title>
                <para>A drawback of using gradient backgrounds is that they are processing intensive
                    and since they are generated each time the graph is generated it can take
                    substantive amount of time for large graphs. To help with this the library
                    offers a small (very simple) utility that can be tun to create gradient images
                    off line. These images can later on be used as (static) background images. In
                    the distribution there is a small utility in the
                    "<filename>Examples/</filename>" directory called
                        "<filename>mkgrad.php</filename>". Pointing the browser to this script will
                    show a basic form as shown in <xref xlink:href="#fig.mkgrad"/>. The script will
                    allow the creation of a gradient images using any of the predefined colors and
                    gradient types.</para>
                <para>
                    <figure xml:id="fig.mkgrad">
                        <title>The "mkgrad" utiliy to create gradient images</title>
                        <mediaobject>
                            <imageobject><imagedata fileref="images/mkgrad.png" scale="70"
                                /></imageobject>
                        </mediaobject>
                    </figure>
                </para>
            </sect2>
        </sect1>
        <sect1 xml:id="sec.adding-texts-to-graphs">
            <title>Adding arbitrary texts to the graph</title>
            <para>In much the same was as icon images can be added to the plot so can arbitrary text
                strings be added. This is done by creating an or several instances of the Text class
                (one per string that is needed). This feature is typically used to add
                clarifications or other information related to the actual graph.</para>
            <para>These text instances are then added to the graph via the normal
                    <code>Graph::Add()</code> method.</para>
            <para>The position of the text in the image/graph can be given as either absolute
                pixels, fractions of the width/height of the graph or as scale values according to
                the specified (or automatically determined) scale.</para>
            <para>To show some ways of positioning the text we use a very simple bar graph not to
                distract from the text. We first just add a single text line with most of the
                settings there default value. We do this by adding te following lines</para>
            <para>
                <programlisting>&lt;?php
// Create an instance of the Text class and set the string at the same time
$txt = new Text('This is a text');

// Position the string at absolute pixels (0,20).
// ( (0,0) is the upper left corner )
$txt->SetPos(0, 20);

// Set color and fonr for the text
$txt->SetColor('red');
$txt->SetFont(FF_FONT2,FS_BOLD);

// ... and add the text to the graph
$graph->AddText($txt); 
?></programlisting>
            </para>
            <para>Teh resulting graph can be seen in <xref xlink:href="#fig.example25"/></para>
            <para>
                <programlisting>#=example25|Adding a text object to a graph#</programlisting>
            </para>
            <para>Let's make the text stand out a bit more by having a background color, framing the
                text box and adding a drop shadow by using the method <code>Text::SetBox()</code>
                The resulting graph can be seen in <xref xlink:href="#fig.example25.1"/></para>
            <para>
                <programlisting>#=example25.1|Making the text stand out a bit more by adding a background color and frame#</programlisting>
            </para>
            <para>In order to use a text with several lines each line needs to be separated by a
                newline ("\n'"character). The default paragraph alignment is left edge but as was
                discussed in ?? paragraph alignment can be adjusted. </para>
            <para>In our final example we a text with several line are place in the middle of the
                plot area.</para>
            <para>
                <programlisting>#=example25.2|Adding a text object with multiple rows of text. Paragraph alignment is set to "center"#</programlisting>
            </para>
            <tip>
                <para>To set the position of the text using scale positions instead use the
                    method</para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>Text::SetScalePos($aX,$aY)</para>
                        </listitem>
                    </itemizedlist>
                </para>
            </tip>
        </sect1>
    </chapter>
</part>
